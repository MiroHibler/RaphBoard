/*! ┌─────────────────────────────────────────────────────────────────────────────────────────────┐ */
/*! │ RaphBoard v1.1.0 - Cross-browser drawing board based on Raphaël                             │ */
/*! ├─────────────────────────────────────────────────────────────────────────────────────────────┤ */
/*! │ Copyright © 2012-2013 Miroslav Hibler (http://MiroHibler.github.com/RaphBoard/)             │ */
/*! ├─────────────────────────────────────────────────────────────────────────────────────────────┤ */
/*! │ Licensed under the MIT license (http://opensource.org/licenses/mit-license.php).            │ */
/*! ├─────────────────────────────────────────────────────────────────────────────────────────────┤ */
/*! │ Requirements: jQuery  (http://jquery.com)                                                   │ */
/*! |               Raphaël (http://raphaeljs.com)                                                │ */
/*! │               Raphaël FreeTransform (http://alias.io/raphael/free_transform/)               │ */
/*! └─────────────────────────────────────────────────────────────────────────────────────────────┘ */
"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),function(e,t,r,n){function a(e,t){return Object.create(C).init(e,t)}function o(e,t){e.options.editable&&e.elements.map(function(r){r.id!==(t?t.id:-1)&&i(e,r,e._mode)})}function i(e,t,r){switch(r){case"move":null==t.freeTransform&&e.initMove(t.id,!0),t.attr({cursor:"pointer"});break;case"text":t.attr({cursor:"text"});break;case"cut":t.hover(b,k),t.attr({cursor:"pointer"});break;case"pen":case"line":case"arrow":case"circle":case"ellipse":case"rect":t.attr({cursor:"crosshair"});break;default:}}function s(e,t){e.options.editable&&e.elements.map(function(r){switch(r.id!==(t?t.id:-1)?l(r,!0):l(r),e._mode){case"move":case"cut":r.attr({cursor:"pointer"});break;case"text":r.attr({cursor:"text"});break;default:r.attr({cursor:"crosshair"})}})}function l(e,t){if(e.events)for(var r=e.events.length,n=0;r>n;n++)switch(e.events[n].f){case b:case v:case k:case B:case S:case D:e["un"+e.events[n].name](e.events[n].f),r=e.events?e.events.length:0,n--;break;default:}e.freeTransform&&!t&&e.freeTransform.unplug()}function c(e,t){var r=!1;return e.paper.freeTransform(t,{animate:!1,attrs:{fill:"#bada55",stroke:"#000"},drag:["center","self"],draw:"circle"===t.type?["bbox"]:["circle","bbox"],keepRatio:"circle"===t.type?!0:!1,rotate:"circle"===t.type?!1:["axisX"],scale:["bboxCorners","bboxSides"],size:{axes:5,bboxCorners:5,bboxSides:5,center:5}},function(a,o){switch(o[0]){case"init":r=!1;break;case"drag start":a.hideHandles({undrag:!1}),t.attr({cursor:"move"});break;case"drag end":a.showHandles(),t.attr({cursor:"pointer"});break;case"rotate start":a.handles.center&&a.handles.center.disc.hide(),a.bbox&&(a.bbox.hide(),a.handles.bbox&&a.handles.bbox.map(function(e){e.element.hide()})),t.attr({cursor:"pointer"});break;case"rotate end":a.handles.center&&a.handles.center.disc.show(),a.bbox&&(a.bbox.show(),a.handles.bbox&&a.handles.bbox.map(function(e){e.element.show()})),t.attr({cursor:"pointer"});break;case"scale start":if(a.handles.center&&a.handles.center.disc.hide(),["x","y"].map(function(e){a.handles[e]&&(a.handles[e].disc.hide(),a.handles[e].line.hide())}),a.bbox){var i;e.paper.getElementsByPoint(a.o.handlePos.cx,a.o.handlePos.cy).forEach(function(e){return"rect"===e.type?(i=e.id,!1):n}),a.handles.bbox&&a.handles.bbox.map(function(e){i!==e.element.id&&e.element.hide()})}a.circle&&a.circle.hide();break;case"scale end":a.handles.center&&a.handles.center.disc.show(),["x","y"].map(function(e){a.handles[e]&&(a.handles[e].disc.show(),a.handles[e].line.show())}),a.bbox&&a.handles.bbox&&a.handles.bbox.map(function(e){e.element.show()}),a.circle&&a.circle.show(),t.attr({cursor:"pointer"});break;default:r=!0}switch(o[0].split(" ")[1]){case"start":w(e,"before_move")&&(p(e,t),U(e,e._mode,t));break;case"end":var s=e.undoBuffer.pop();r&&(s.element.data.ft.attrs=W(e,t),delete s.element.attrs.cursor,e.undoBuffer.push(s),e.clearRedo(),r=!1),w(e,"after_move");break;default:}})}function u(e,t){return w(e,"before_select")&&(t.attr({cursor:"move"}),e.select(t.id)),w(e,"after_select"),t}function f(e,t){return e.elements.map(function(r){r.id!==(t?t.id:-1)&&d(e,r)}),t}function d(e,t){return w(e,"before_deselect")&&e.deselect(t.id),w(e,"after_deselect"),t}function h(e,t){if(w(e,"before_show_handles")&&t.freeTransform){var r=t.freeTransform;r.handles.center&&r.handles.center.disc.show(),r.bbox&&(r.bbox.show(),r.handles.bbox&&r.handles.bbox.map(function(e){e.element.show()})),["x","y"].map(function(e){r.handles[e]&&(r.handles[e].disc.show(),r.handles[e].line.show())}),r.circle&&r.circle.show()}return w(e,"after_show_handles"),t}function p(e,t){var r=e.elements;return r.map(function(r){r.id!==(t?t.id:-1)&&m(e,r)}),t}function m(e,t){if(w(e,"before_hide_handles")&&t.freeTransform){var r=t.freeTransform;r.handles.center&&r.handles.center.disc.hide(),r.bbox&&(r.bbox.hide(),r.handles.bbox&&r.handles.bbox.map(function(e){e.element.hide()})),["x","y"].map(function(e){r.handles[e]&&(r.handles[e].disc.hide(),r.handles[e].line.hide())}),r.circle&&r.circle.hide()}return w(e,"after_hide_handles"),t}function b(){var t=this,r=e(t.node),n=r.parent().parent().parent().data("RaphBoard");t.mousedown(v),g(n,t)}function v(){var t=this,r=e(t.node),n=r.parent().parent().parent().data("RaphBoard");w(n,"before_cut")&&(l(t),x(n,t),n.cut(t.id)),w(n,"after_cut")}function k(){var t=this,r=e(t.node),n=r.parent().parent().parent().data("RaphBoard");t.unmousedown(v),x(n,t)}function g(e,t){e.cutStroke=t.attr("stroke"),e.cutStrokeWidth=t.attr("stroke-width"),e.cutStrokeDash=t.attr("stroke-dasharray"),"path"!=t.type&&"none"!=t.attr("fill")&&(e.cutFill=t.attr("fill"),e.cutOpacity=t.attr("fill-opacity"),t.attr({fill:"#F00","fill-opacity":1})),t.attr({stroke:"#F00","stroke-width":1,"stroke-dasharray":"-"}),"path"!=t.type&&"none"!=t.attr("fill")&&t.animate({"fill-opacity":.5},100)}function x(e,t){"path"!=t.type&&"none"!=t.attr("fill")&&t.animate({"fill-opacity":e.cutOpacity},100).attr({fill:e.cutFill,"fill-opacity":e.cutOpacity}),t.attr({stroke:e.cutStroke,"stroke-width":e.cutStrokeWidth,"stroke-dasharray":e.cutStrokeDash})}function _(e){var t=e.parent().data("RaphBoard");switch(t._mode){case"move":case"cut":e.css({cursor:"pointer"});break;case"text":e.css({cursor:"text"});break;default:e.css({cursor:"crosshair"})}e.unbind("mouseenter").mouseleave(R),"cut"!=t._mode&&e.mousedown(B)}function w(e,t){var r=e.eventHandlers[t];return r?r(e):!0}function y(t){var r=e(t.delegateTarget),n=r.parent().data("RaphBoard");n.options.editable&&_(r)}function B(t){t.originalEvent.preventDefault();var r=e(t.delegateTarget),n=r.parent().data("RaphBoard");if(n.mouseDownX=t.pageX-n.left(),n.mouseDownY=t.pageY-n.top()-(n.toolBar?n.toolBar.height():0),w(n,"before_start")){var a=n.elements;switch(n._mode){case"pen":a.push(Y(n,n.mouseDownX,n.mouseDownY));break;case"line":a.push(Y(n,n.mouseDownX,n.mouseDownY));break;case"arrow":a.push(Y(n,n.mouseDownX,n.mouseDownY).attr({"arrow-end":n.options.arrowEnd}));break;case"circle":a.push(M(n,n.mouseDownX,n.mouseDownY));break;case"ellipse":a.push(j(n,n.mouseDownX,n.mouseDownY));break;case"rect":a.push(A(n,n.mouseDownX,n.mouseDownY));break;case"text":J(n,n.mouseDownX,n.mouseDownY);break;default:var o=n.paper.getElementByPoint(t.pageX,t.pageY);null==o&&(f(n),n.multiSelect=A(n,n.mouseDownX,n.mouseDownY),n.multiSelect.attr({fill:"#bada55","fill-opacity":.1,stroke:"#bada55","stroke-width":1,"stroke-dasharray":"-"}))}"text"!=n._mode&&"cut"!=n._mode&&(("move"!=n._mode||null!=n.multiSelect)&&r.mousemove(S),r.mouseup(D))}w(n,"after_start")}function S(t){var r=e(t.delegateTarget),n=r.parent().data("RaphBoard");if(w(n,"before_change")){var a=n.elements[n.elements.length-1],o=t.pageX-n.left(),i=t.pageY-n.top()-(n.toolBar?n.toolBar.height():0),s=o-n.mouseDownX,l=i-n.mouseDownY;switch(n._mode){case"pen":a.attr("path",a.attr("path")+"L"+o+","+i);break;case"line":a.attr("path","M"+n.mouseDownX+" "+n.mouseDownY+"L"+o+","+i);break;case"arrow":a.attr("path","M"+n.mouseDownX+" "+n.mouseDownY+"L"+o+","+i);break;case"circle":a.attr("r",Math.max(Math.abs(s),Math.abs(l)));break;case"ellipse":a.attr("rx",Math.abs(s)).attr("ry",Math.abs(l));break;case"rect":0>s&&a.attr("x",o),0>l&&a.attr("y",i),a.attr("width",Math.abs(s)).attr("height",Math.abs(l));break;case"text":break;default:n.multiSelect&&(0>s&&n.multiSelect.attr("x",o),0>l&&n.multiSelect.attr("y",i),n.multiSelect.attr("width",Math.abs(s)).attr("height",Math.abs(l)))}}w(n,"after_change")}function D(t){var r=e(t.delegateTarget),n=r.parent().data("RaphBoard");if(n.mouseUpX=t.pageX-n.left(),n.mouseUpY=t.pageY-n.top()-(n.toolBar?n.toolBar.height():0),w(n,"before_end")){switch(n._mode){case"cut":case"text":break;case"move":if(n.multiSelect){var a=n.multiSelect.getBBox();n.multiSelect.remove(),n.multiSelect=null,0!==a.width&&0!==a.height&&n.elements.map(function(e){Raphael.isBBoxIntersect(a,e.getBBox())&&u(n,e)})}o(n);break;default:var i=n.elements;element=i.pop();var a=element.getBBox();0==a.width&&0==a.height?element.remove():(i.push(element),U(n,n._mode,element))}"text"!=n._mode&&"cut"!=n._mode&&r.unbind("mousemove").unbind("mouseup")}w(n,"after_end")}function R(t){t.stopPropagation();var r=e(t.delegateTarget);r.unbind("mouseleave").removeClass("cursor-*");var n=r.parent().data("RaphBoard");"cut"!=n._mode&&r.unbind("mousedown"),r.mouseenter(y)}function T(e,t){for(var r=e.length-1;r>=0;r--){var n=e[r].element;if(n.id==t)return n}return null}function U(e,t,r){var r={command:t,element:X(e,r)};switch(e.undoBuffer.push(r),t){case"cut":case"clear":case"move":case"modify":case"transform":break;default:e.clearRedo()}}function O(e,t,r){var n=!1,a=t.freeTransform;return a||(n=!0,a=e.paper.freeTransform(t).setOpts({animate:e.options.animation})),a.attrs=JSON.parse(JSON.stringify(r)),a.apply(),n&&a.unplug(),t}function W(e,t){var r,n=!1,a=t.freeTransform;return a||(n=!0,a=e.paper.freeTransform(t)),r=JSON.parse(JSON.stringify(a.attrs)),n&&a.unplug(),r}function X(e,t){var r={data:{ft:{attrs:W(e,t)}},id:t.id,type:t.type,attrs:JSON.parse(JSON.stringify(t.attrs)),transform:t.matrix.toTransformString()};return delete r.attrs.transform,r}function Y(e,t,r){var n=e.paper.path("M"+t+" "+r);return 0==e.options.strokeWidth&&(e.options.stroke=e.options.fill,e.options.strokeWidth=1),n.attr({stroke:e.options.stroke,"stroke-width":e.options.strokeWidth,"stroke-linecap":e.options.lineCap,"stroke-linejoin":e.options.lineJoin}),n}function M(e,t,r){var n=e.paper.circle(t,r,0);return n.attr({fill:e.options.fill,stroke:e.options.stroke,"stroke-width":e.options.strokeWidth,"stroke-linecap":e.options.lineCap,"stroke-linejoin":e.options.lineJoin}),n}function j(e,t,r){var n=e.paper.ellipse(t,r,0,0);return n.attr({fill:e.options.fill,stroke:e.options.stroke,"stroke-width":e.options.strokeWidth,"stroke-linecap":e.options.lineCap,"stroke-linejoin":e.options.lineJoin}),n}function A(e,t,r){var n=e.paper.rect(t,r,0,0);return n.attr({fill:e.options.fill,stroke:e.options.stroke,"stroke-width":e.options.strokeWidth,"stroke-linecap":e.options.lineCap,"stroke-linejoin":"miter"}),n}function J(e,t,r){var n=prompt("Please enter text:\nOptionally, you can specify text size by\nprepending text size as number enclosed in {}","{"+e.options.fontSize+"}Write some text here...");if(n&&""!=n){var a=e.options.fontSize;return"{"==n[0]&&(a=n.substring(1,n.indexOf("}")),n=n.substring(n.indexOf("}")+1)),e.text(t,r,n,a)}}function F(e,t,r,n){var a=e.paper.text(t,r,n),o=e.options;return a.attr({fill:o.fill,stroke:o.stroke,"stroke-width":o.strokeWidth,"stroke-linecap":o.lineCap,"stroke-linejoin":o.lineJoin,"font-size":o.fontSize}),o.font&&a.attr({font:'"'+o.fontSize+'px "'+o.font+'"'}),o.fontFamily&&a.attr({"font-family":o.fontFamily}),o.fontStyle&&a.attr({"font-style":o.fontStyle}),o.fontWeight&&a.attr({"font-weight":o.fontWeight}),o.textAnchor&&a.attr({"text-anchor":o.textAnchor}),o.textDecoration&&a.attr({"text-decoration":o.textDecoration}),a}function H(e,t){var r,n,a=e.elements,o=t.attrs;switch(t.type){case"circle":r=e.paper.circle(o.cx,o.cy,o.r);break;case"ellipse":r=e.paper.ellipse(o.cx,o.cy,o.rx,o.ry);break;case"rect":r=e.paper.rect(o.x,o.y,o.width,o.height);break;case"text":r=e.paper.text(o.x,o.y,o.text);break;default:r=e.paper.path("")}r.id=t.id,r.node.raphaelid=t.id,r.attr(o),r.transform(t.transform);for(var i=a.length-1;i>=0;i--)if(r.id>a[i].id){n=a[i].id;break}return n?(r.insertAfter(e.paper.getById(n)),a.splice(i+1,0,r)):a.push(r),r}var C={init:function(t,r){var n=this;n._board=t,n._container=e("#"+r),n._container.css({position:"absolute",width:n._board.width()+"px",height:n._board.height()-(n._board.options.showToolBar?n._board.toolBar.height():0)+"px"}),n._paper=Raphael(r,n._board.width(),n._board.height()-(n._board.options.showToolBar?n._board.toolBar.height():0));var a=n._container.children(":first");return"relative"==a.css("position")&&(a.css("left",""),a.css("top","")),n},paper:function(){return this._paper}},I={init:function(t,r){var n=this;if(n._version="1.1.0",n._UUID=Raphael.createUUID(),n.elem=r,n.$elem=e(r),t&&t.strokeWidth)switch(t.strokeWidth){case"medium":t.strokeWidth=4;break;case"big":t.strokeWidth=8;break;case"huge":t.strokeWidth=12;break;default:t.strokeWidth=1}if(n.options=e.extend({},e.fn.RaphBoard.options,t),n.eventHandlers={before_mode_change:null,after_mode_change:null,before_start:null,after_start:null,before_change:null,after_change:null,before_end:null,after_end:null,before_select:null,after_select:null,before_deselect:null,after_deselect:null,before_show_handles:null,after_show_handles:null,before_hide_handles:null,after_hide_handles:null,before_move:null,after_move:null,before_cut:null,after_cut:null,before_undo:null,after_undo:null,before_redo:null,after_redo:null,before_clear:null,after_clear:null,updateUndoRedo:null},"undefined"!=typeof _toolBar&&null!=_toolBar){var o="r_b-toolbar";n.$elem.append("<div id='"+o+"'/>"),n.toolBar=ToolBar(n,o);var i="r_b-overlay";n.$elem.append("<div id='"+i+"'/>"),n.attributesPanel=AttributesPanel(n,i)}var s="r_b-paper";return n.$elem.append("<div id='"+s+"'/>"),n.canvas=a(n,s),n.paper=n.canvas.paper(),n.elements=[],n.undoBuffer=[],n.redoBuffer=[],n.mode("pen"),n.mouseDownX=n.mouseDownY=n.mouseUpX=n.mouseUpY=0,n.canvas._container.mouseenter(y),n},container:function(){return this.elem},version:function(){return this._version},UUID:function(){return this._UUID},left:function(){return this.$elem.offset().left},top:function(){return this.$elem.offset().top},width:function(){return this.$elem.width()},height:function(){return this.$elem.height()},isEnabled:function(){return this.options.editable},canUndo:function(){return this.undoBuffer.length>0},canRedo:function(){return this.redoBuffer.length>0},getAttribute:function(e){var t=this.options;return"align"==e?t.textAnchor:t[e]},toggleAttribute:function(e){var t=this.options;switch(e){case"editable":t.editable=!t.editable;break;case"bold":t.fontWeight="bold"==t.fontWeight?"normal":"bold";break;case"italic":t.fontStyle="italic"==t.fontStyle?"normal":"italic";break;case"underline":t.textDecoration="underline"==t.textDecoration?"none":"underline";break;case"strike":t.textDecoration="line-through"==t.textDecoration?"none":"line-through";break;default:}return t[e]},setAttribute:function(e,t){var r=this.options;if("align"==e)switch(t){case"left":r.textAnchor="start";break;case"center":r.textAnchor="middle";break;case"right":r.textAnchor="end";break;case"justify":r.textAnchor="middle";break;default:r.textAnchor="start"}else r[e]=t;return r[e]},on:function(t,r){var a=this;return e.each(a.eventHandlers,function(e){return(e=t)?(a.eventHandlers[t]=r,!1):n}),a},off:function(t){var r=this;return e.each(r.eventHandlers,function(e){return(e=t)?(r.eventHandlers[t]=null,!1):n}),r},enable:function(){var e=this;return e.options.editable=!0,e.toolBar&&e.toolBar.enable(),e},disable:function(){var e=this;return e.canvas._container.unbind("mouseenter"),e.elem.removeClasses("cursor-*"),e.options.editable=!1,e.toolBar&&e.toolBar.disable(),e},mode:function(e){var t=this;return e!==n&&(w(t,"before_mode_change")&&(s(t),t._mode=e,t.options.editable&&t.toolBar&&(t.toolBar.deselectAll(),t.toolBar.button(t._mode).select()),o(t)),w(t,"after_mode_change")),t._mode},element:function(t){var r,a=this;return e.each(a.elements,function(e,a){return a.id==t?(r=a,!1):n}),r},initMove:function(e,t){var r=this,n=r.element(e);if(n&&n.freeTransform)var a=n.freeTransform;else var a=c(r,n);return t?a.hideHandles({undrag:!1}):a.showHandles(),n},select:function(e){var t=this;return t.initMove(e)},deselect:function(e,t){var r=this,n=r.element(e);return n&&l(n,t),n},showHandles:function(e){var t=this,r=t.element(e);return r?h(t,r):n},hideHandles:function(e){var t=this,r=t.element(e);return r?m(t,r):n},move:function(e,t,r){var n=this,a=n.element(e);if(n.options.animation,a){switch(a.type){case"path":var o=a.matrix.toTransformString().replace("t","").split(",");a.ox=o[0]?o[0]:0,a.oy=o[1]?o[1]:0;break;case"circle":case"ellipse":a.ox=a.attr("cx"),a.oy=a.attr("cy");break;default:a.ox=a.attr("x"),a.oy=a.attr("y")}var i=t-a.ox,s=r-a.oy;switch(a.type){case"path":a.transform("t"+(parseInt(a.ox)+parseInt(i))+","+(parseInt(a.oy)+parseInt(s)));break;case"circle":case"ellipse":a.attr({cx:a.ox+i,cy:a.oy+s});break;default:a.attr({x:a.ox+i,y:a.oy+s})}n.paper.safari(),U(n,"move",a)}return a},modify:function(e,t){var r=this,n=r.element(e);return r.options.animation,n&&"object"==typeof t&&(n.attr(t),r.paper.safari(),U(r,"modify",n)),n},transform:function(e,t){var r=this;r.options.animation;var n=r.element(e);return n&&"string"==typeof t&&(n.transform(t),r.paper.safari(),U(r,"transform",n)),n},freeTransform:function(e,t){var r=this,n=r.element(e);if(n){if("object"!=typeof t)return W(r,n);O(r,n,t),U(r,"move",n)}return n},line:function(e,t,r,n){var a=this;if(0!=r||0!=n){var o=Y(a,e,t);return o.attr("path","M"+e+","+t+"L"+r+","+n),a.elements.push(o),U(a,"line",o),o}return null},arrow:function(e,t,r,n){var a=this;if(0!=r||0!=n){var o=Y(a,e,t);return o.attr("path","M"+e+","+t+"L"+r+","+n),a.elements.push(o),U(a,"arrow",o),o}return null},circle:function(e,t,r){var n=this;if(0!=r){var a=M(n,e,t);return a.attr("r",r),n.elements.push(a),U(n,"circle",a),a}return null},ellipse:function(e,t,r,n){var a=this;if(0!=r||0!=n){var o=j(a,e,t);return o.attr("rx",r).attr("ry",n),a.elements.push(o),U(a,"ellipse",o),o}return null},rect:function(e,t,r,n){var a=this;if(0!=r||0!=n){var o=A(a,e,t);return o.attr("dx",r).attr("dy",n),a.elements.push(o),U(a,"rect",o),o}return null},text:function(e,t,r,n){var a=this;if(r&&""!=r){if(n&&!isNaN(n)){var o=Math.abs(parseInt(n));a.options.fontSize=0==o?12:o}var i=F(a,e,t,r);return a.elements.push(i),U(a,"text",i),w(a,"after_end"),i}return null},cut:function(e){var t=this,r=t.elements,n=!1;if(r.length>0)for(var a=0;r.length>a;a++)if(r[a].id==e){U(t,"cut",r[a]),r[a].remove(),r.splice(a,1),n=!0;break}return n},toJSON:function(e,t){var r=this,n=[],a=[],o=r.paper,i=function(e){var a=t?t(e,{}):{};a&&(a.ft={attrs:W(r,e)},n.push({command:e.type,element:{data:a,type:e.type,attrs:e.attrs,transform:e.matrix.toTransformString(),id:e.id}}))};e?i(o.getById(e)):o.forEach(function(e){i(e)});var s=JSON.stringify(n,function(e,t){if("object"==typeof t&&null!=t){if(-1!==a.indexOf(t))return;a.push(t)}return t});return n=a=null,s},fromJSON:function(e,t){var r,n=this,a=[];r="string"==typeof e?JSON.parse(e):e,r instanceof Array?a=r:a.push(r);for(var o in a)if(a.hasOwnProperty(o)){var i=H(n,a[o].element),s=a[o].element.data;s&&s.ft&&s.ft.attrs&&O(n,i,s.ft.attrs),t&&t(i),U(n,a[o].command,i)}},undo:function(){var e=this;if(e.canUndo()&&w(e,"before_undo")){e.paper;var t=e.elements,r=e.undoBuffer,n=r.pop(),a=n.command;switch(s(e),a){case"move":var i=T(r,n.element.id);i&&(e.freeTransform(i.id,i.data.ft.attrs),e.undoBuffer.pop());break;case"modify":var i=T(r,n.element.id);if(i){e.modify(i.id,i.attrs),e.undoBuffer.pop();break}break;case"transform":var i=T(r,n.element.id);if(i){e.transform(i.id,i.transform),e.undoBuffer.pop();break}break;case"cut":H(e,n.element);break;case"clear":n.elements.map(function(t){H(e,t)});break;default:t.pop().remove()}switch(e.redoBuffer.push(n),a){case"modify":case"transform":case"undo":case"redo":case"clear":break;default:e.mode(a),o(e)}}return e.toggleUndoRedo(),w(e,"after_undo"),e},clearUndo:function(){var e=this;return e.undoBuffer=[],e.toggleUndoRedo(),e},redo:function(){var e=this;if(e.canRedo()&&w(e,"before_redo")){e.elements;var t=e.redoBuffer;e.paper;var r=t.pop(),n=r.command,a=r.element;switch(s(e),n){case"move":e.freeTransform(a.id,r.element.data.ft.attrs),e.undoBuffer.pop(),e.undoBuffer.push(r);break;case"modify":e.modify(a.id,a.attrs);break;case"transform":e.transform(a.id,a.transform);break;case"cut":e.cut(a.id);break;case"clear":e.clear();break;default:H(e,a),e.undoBuffer.push(r)}switch(n){case"modify":case"transform":case"undo":case"redo":case"clear":break;default:e.mode(n),o(e)}}return e.toggleUndoRedo(),w(e,"after_redo"),e},clearRedo:function(){var e=this;return e.redoBuffer=[],e.toggleUndoRedo(),e},toggleUndoRedo:function(){var e=this;if(e.toolBar){var t=e.eventHandlers.updateUndoRedo;t?t(e):e.toolBar.toggleUndoRedo()}return e},clear:function(){var e=this;if(e.elements.length>0&&w(e,"before_clear")){s(e);var t=[];e.elements.map(function(r){t.push(X(e,r))}),e.undoBuffer.push({command:"clear",elements:t}),e.elements=[],e.paper.clear()}return e.clearRedo(),w(e,"after_clear"),e},flush:function(){var e=this;return s(e),e.elements=[],e.paper.clear(),e.clearUndo(),e.clearRedo(),e}};e.fn.RaphBoard=function(t,r){var a=e(this).data("RaphBoard");return a||(a=Object.create(I),a.init(t,this),e.data(this.get(0),"RaphBoard",a)),t!==n&&("object"==typeof t?a.options=e.extend({},e.fn.RaphBoard.options,t):"string"==typeof t&&(a.options=e.extend({},e.fn.RaphBoard.options,{options:r}))),a},e.fn.RaphBoard.options={editable:!0,stroke:"#FFF",strokeWidth:1,fill:"#FFF",lineCap:"round",lineJoin:"round",arrowEnd:"classic-medium-medium",fontSize:12,font:null,fontFamily:null,fontStyle:null,fontWeight:null,textAnchor:"start",textDecoration:null,animation:{delay:100,easing:"<>"}},e.fn.removeClasses=function(e){return this.removeClass(function(t,r){var n=e.replace(/\*/g,"\\S+");return(r.match(RegExp("\\b"+n,"g"))||[]).join(" ")})}}(jQuery,window,document);