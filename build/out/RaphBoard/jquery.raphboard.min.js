"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),function(t){function e(t,e,r){return Object.create(U).init(t,e,r)}function r(t,e,r){return Object.create(T).init(t,e,r)}function a(t,e){return Object.create(j).init(t,e)}function o(t,e){return Object.create(Y).init(t,e)}function n(t,e){return Object.create(E).init(t,e)}function i(t){if(t.options.editable)for(var e=t.shapes,r=0;e.length>r;r++){var a=e[r];switch(t.mode){case"move":s(a),a.drag(m,d,k),a.attr({cursor:"move"});break;case"text":s(a),a.attr({cursor:"text"});break;case"cut":s(a),a.hover(l,p),a.attr({cursor:"pointer"});break;case"pen":case"line":case"arrow":case"circle":case"ellipse":case"rect":s(a),a.attr({cursor:"crosshair"});break;default:}}}function s(t){t.unhover(l,p),t.undrag()}function c(t){if(t.options.editable)for(var e=t.shapes,r=0;e.length>r;r++){var a=e[r];s(a),a.attr({cursor:"crosshair"})}}function l(){var e=t(this.node),r=e.parent().parent().parent().data("RaphBoard");this.mousedown(h),u(r,this)}function h(){var e=t(this.node),r=e.parent().parent().parent().data("RaphBoard");this.unmousedown(h).unhover(l,p),w(r,"before_cut")&&(f(r,this),r.cut(this.id)),w(r,"after_cut")}function p(){var e=t(this.node),r=e.parent().parent().parent().data("RaphBoard");this.unmousedown(h),f(r,this)}function u(t,e){t.cutStroke=e.attr("stroke"),t.cutStrokeWidth=e.attr("stroke-width"),t.cutStrokeDash=e.attr("stroke-dasharray"),"path"!=e.type&&"none"!=e.attr("fill")&&(t.cutFill=e.attr("fill"),t.cutOpacity=e.attr("fill-opacity"),e.attr({fill:"#F00","fill-opacity":1})),e.attr({stroke:"#F00","stroke-width":4>t.cutStrokeWidth?4:t.cutStrokeWidth,"stroke-dasharray":"-"}),"path"!=e.type&&"none"!=e.attr("fill")&&e.animate({"fill-opacity":.5},100)}function f(t,e){"path"!=e.type&&"none"!=e.attr("fill")&&e.animate({"fill-opacity":t.cutOpacity},100).attr({fill:t.cutFill,"fill-opacity":t.cutOpacity}),e.attr({stroke:t.cutStroke,"stroke-width":t.cutStrokeWidth,"stroke-dasharray":t.cutStrokeDash})}function d(){var e=t(this.node),r=e.parent().parent().parent().data("RaphBoard"),a=this;w(r,"before_start")&&(v(a),r.dragStroke=a.attr("stroke"),r.dragOpacity=a.attr("fill-opacity"),r.dragStrokeWidth=a.attr("stroke-width"),r.dragStrokeDash=a.attr("stroke-dasharray"),a.attr({stroke:"#FFF","stroke-width":1,"stroke-dasharray":"-"}),a.animate({"fill-opacity":0},100)),w(r,"after_start")}function v(t){switch(t.type){case"path":var e=t.matrix.toTransformString().replace("t","").split(",");t.ox=e[0]?e[0]:0,t.oy=e[1]?e[1]:0;break;case"circle":case"ellipse":t.ox=t.attr("cx"),t.oy=t.attr("cy");break;default:t.ox=t.attr("x"),t.oy=t.attr("y")}}function m(e,r){var a=t(this.node),o=a.parent().parent().parent().data("RaphBoard"),n=this;w(o,"before_change")&&b(o,n,e,r),w(o,"after_change")}function b(t,e,r,a){switch(e.type){case"path":e.transform("t"+(parseInt(e.ox)+parseInt(r))+","+(parseInt(e.oy)+parseInt(a)));break;case"circle":case"ellipse":e.attr({cx:e.ox+r,cy:e.oy+a});break;default:e.attr({x:e.ox+r,y:e.oy+a})}t.paper.safari()}function k(){var e=t(this.node),r=e.parent().parent().parent().data("RaphBoard"),a=this;w(r,"before_end")&&(a.animate({"fill-opacity":r.dragOpacity},100),a.attr({stroke:r.dragStroke,"stroke-width":r.dragStrokeWidth,"stroke-dasharray":r.dragStrokeDash}),z(r,"move",a)),w(r,"after_end")}function g(t){var e=t.parent().data("RaphBoard");switch(e.shapes,e.mode){case"move":case"cut":t.css({cursor:"pointer"});break;case"text":t.css({cursor:"text"});break;default:t.css({cursor:"crosshair"})}t.unbind("mouseenter").mouseleave(C),"move"!=e.mode&&"cut"!=e.mode&&t.mousedown(B)}function w(t,e){var r=t.eventHandlers[e];return r?r(t):!0}function x(e){var r=t(e.delegateTarget),a=r.parent().data("RaphBoard");a.options.editable&&g(r)}function B(e){e.originalEvent.preventDefault();var r=t(e.delegateTarget),a=r.parent().data("RaphBoard");if(a.mouseDownX=e.pageX-a.left(),a.mouseDownY=e.pageY-a.top()-(a.options.showToolBar?a.toolBar.height:0),w(a,"before_start")){var o=a.shapes;switch(a.mode){case"pen":o.push(D(a,a.mouseDownX,a.mouseDownY));break;case"line":o.push(D(a,a.mouseDownX,a.mouseDownY));break;case"arrow":o.push(D(a,a.mouseDownX,a.mouseDownY).attr({"arrow-end":a.options.arrowEnd}));break;case"circle":o.push(S(a,a.mouseDownX,a.mouseDownY));break;case"ellipse":o.push(I(a,a.mouseDownX,a.mouseDownY));break;case"rect":o.push(F(a,a.mouseDownX,a.mouseDownY));break;case"text":L(a,a.mouseDownX,a.mouseDownY);break;default:}}w(a,"after_start"),"move"!=a.mode&&"text"!=a.mode&&"cut"!=a.mode&&r.mousemove(y).mouseup(M)}function y(e){var r=t(e.delegateTarget),a=r.parent().data("RaphBoard");if(w(a,"before_change")){var o=a.shapes[a.shapes.length-1],n=e.pageX-a.left(),i=e.pageY-a.top()-(a.options.showToolBar?a.toolBar.height:0),s=n-a.mouseDownX,c=i-a.mouseDownY;switch(a.mode){case"pen":o.attr("path",o.attr("path")+"L"+n+","+i);break;case"line":o.attr("path","M"+a.mouseDownX+" "+a.mouseDownY+"L"+n+","+i);break;case"arrow":o.attr("path","M"+a.mouseDownX+" "+a.mouseDownY+"L"+n+","+i);break;case"circle":o.attr("r",Math.max(Math.abs(s),Math.abs(c)));break;case"ellipse":o.attr("rx",Math.abs(s)).attr("ry",Math.abs(c));break;case"rect":0>s&&o.attr("x",n),0>c&&o.attr("y",i),o.attr("width",Math.abs(s)).attr("height",Math.abs(c));break;case"text":break;default:}}w(a,"after_change")}function M(e){var r=t(e.delegateTarget),a=r.parent().data("RaphBoard");if(w(a,"before_end")&&"move"!=a.mode&&"text"!=a.mode&&"cut"!=a.mode){var o=a.shapes;r.unbind("mouseup").unbind("mousemove"),shape=o.pop();var n=shape.getBBox();0==n.width&&0==n.height?shape.remove():(o.push(shape),z(a,a.mode,shape))}w(a,"after_end")}function C(e){var r=t(e.delegateTarget);r.unbind("mouseleave").removeClass("cursor-*");var a=r.parent().data("RaphBoard");"move"!=a.mode&&"cut"!=a.mode&&r.unbind("mousedown"),r.mouseenter(x)}function z(t,e,r){var a={command:e,shape:R(r)};t.undoBuffer.push(a),"cut"!=e&&"clear"!=e&&"move"!=e&&t.clearRedo()}function R(t){return{id:t.id,type:t.type,attrs:_(t),transform:t.matrix.toTransformString()}}function _(e){var r={};return t.each(e.attrs,function(t,e){r[t]=e}),r}function D(t,e,r){var a=t.paper.path("M"+e+" "+r);return 0==t.options.strokeWidth&&(t.options.stroke=t.options.fill,t.options.strokeWidth=1),a.attr({stroke:t.options.stroke,"stroke-width":t.options.strokeWidth,"stroke-linecap":t.options.lineCap,"stroke-linejoin":t.options.lineJoin}),a}function S(t,e,r){var a=t.paper.circle(e,r,0);return a.attr({fill:t.options.fill,stroke:t.options.stroke,"stroke-width":t.options.strokeWidth,"stroke-linecap":t.options.lineCap,"stroke-linejoin":t.options.lineJoin}),a}function I(t,e,r){var a=t.paper.ellipse(e,r,0,0);return a.attr({fill:t.options.fill,stroke:t.options.stroke,"stroke-width":t.options.strokeWidth,"stroke-linecap":t.options.lineCap,"stroke-linejoin":t.options.lineJoin}),a}function F(t,e,r){var a=t.paper.rect(e,r,0,0);return a.attr({fill:t.options.fill,stroke:t.options.stroke,"stroke-width":t.options.strokeWidth,"stroke-linecap":t.options.lineCap,"stroke-linejoin":"miter"}),a}function L(t,e,r){if(text=prompt("Please enter text:\nYou can specify text size by prepending\ntext size as number enclosed in {}","{"+t.options.fontSize+"}Write some text here..."),text&&""!=text){var a=text;if("{"==text[0]){var o=text.substring(1,text.indexOf("}"));if(""!=o&&!isNaN(o)){var n=Math.abs(parseInt(o));t.options.fontSize=0==n?12:n,a=text.substring(text.indexOf("}")+1)}}if(""!=a){var i=W(t,e,r,a);return t.shapes.push(i),z(t,"text",i),i}}}function W(t,e,r,a){var o=t.paper.text(e,r,a);return o.attr({fill:t.options.fill,stroke:t.options.stroke,"stroke-width":t.options.strokeWidth,"stroke-linecap":t.options.lineCap,"stroke-linejoin":t.options.lineJoin,"font-size":t.options.fontSize,"text-anchor":t.options.textAnchor}),o}function O(t,e){var r;switch(e.type){case"circle":r=t.paper.circle(0,0,0);break;case"ellipse":r=t.paper.ellipse(0,0,0,0);break;case"rect":r=t.paper.rect(0,0,0,0);break;case"text":r=t.paper.text(0,0,"");break;default:r=t.paper.path("")}r.id=e.id,r.attr(e.attrs),r.transform(e.transform);for(var a,o=t.shapes.length-1;o>=0;o--)if(r.id>t.shapes[o].id){a=t.shapes[o].id;break}return a?(r.insertAfter(t.paper.getById(a)),t.shapes.splice(o+1,0,r)):t.shapes.push(r),r}var U={init:function(t,e,r){var a=this;return a.button=t,a.path=t.toolBar.paper.path(e).attr(r),a},show:function(){this.path.show()},isVisible:function(){return"none"!==this.path.node.style.display},hide:function(){this.path.hide()},isGlowing:function(){return"object"==typeof this.path.g},glow:function(t){var e=this;t?e.path.g=e.path.glow():e.isGlowing()&&e.path.g.remove()}},T={init:function(t,e,r){var a=this;a.icons=[],a.name=e,a.toolBar=t,a.isEnabled=!0,a.isSelected=!1;var o=t.paper;return a.set=o.set(),a.paths=o.set(),a.set.push(a.paths),a.rect=o.rect(0,0,0,0).attr(r),a.set.push(a.rect),a},addIcon:function(t,r){var a=this,o=e(a,t,r);return a.icons.push(o),a.paths.push(o.path),a.showIcon(a.icons.length-1),a.rect.toFront(),o},showIcon:function(t){var e=this;for(ndx in e.icons)e.icons[ndx].hide();e.icons[t].show()},activeIcon:function(){var t,e=this;for(ndx in e.icons)if(e.icons[ndx].isVisible){t=e.icons[ndx];break}return t},removeIcon:function(t){var e=this;e.icons[t].path.remove(),e.icons.splice(t,1)},highlight:function(t,e){var r=this;t?(r.activeIcon().glow(e),r.activeIcon().path.attr({fill:"90-#6B9DF4-#4575ED",stroke:"none"})):(r.activeIcon().glow(!1),r.activeIcon().path.attr({fill:"90-#888-#CCC",stroke:"none"}))},hover:function(t,e){var r=this;r.mouseIn=t,r.mouseOut=e,r.rect.hover(function(){r.isEnabled&&r.mouseIn()},function(){r.isEnabled&&r.mouseOut()})},mouseDown:function(t){var e=this;e.mouseDown=t,e.rect.mousedown(function(){e.isEnabled&&e.mouseDown()})},mouseUp:function(t){var e=this;e.mouseUp=t,e.rect.mouseup(function(){e.isEnabled&&e.mouseUp()})},select:function(t){var e=this;e.isSelected=t,e.highlight(t,t)},enabled:function(t){this.isEnabled=t}},j={init:function(e,a){var o=this;o.isEnabled=!0,o.height=40,o.container=t("#"+a),o.buttons=[],o.container.css({position:"relative",width:e.width()+"px",height:o.height+"px"}),o.paper=Raphael(a,e.width(),o.height);var n=o.container.children(":first");"relative"==n.css("position")&&(n.css("left",""),n.css("top","")),o.background=o.paper.rect(0,0,e.width(),o.height).attr({fill:"90-#555-#000",stroke:"none"});var i={move:{title:"Move",path:"M14.296,27.885v-2.013c0,0-0.402-1.408-1.073-2.013c-0.671-0.604-1.274-1.274-1.409-1.61c0,0-0.268,0.135-0.737-0.335s-1.812-2.616-1.812-2.616l-0.671-0.872c0,0-0.47-0.671-1.275-1.342c-0.805-0.672-0.938-0.067-1.476-0.738s0.604-1.275,1.006-1.409c0.403-0.134,1.946,0.134,2.684,0.872c0.738,0.738,0.738,0.738,0.738,0.738l1.073,1.141l0.537,0.201l0.671-1.073l-0.269-2.281c0,0-0.604-2.55-0.737-4.764c-0.135-2.214-0.47-5.703,1.006-5.837s1.007,2.55,1.073,3.489c0.067,0.938,0.806,5.232,1.208,5.568c0.402,0.335,0.671,0.066,0.671,0.066l0.402-7.514c0,0-0.479-2.438,1.073-2.549c0.939-0.067,0.872,1.543,0.872,2.147c0,0.604,0.269,7.514,0.269,7.514l0.537,0.135c0,0,0.402-2.214,0.604-3.153s0.604-2.416,0.537-3.087c-0.067-0.671-0.135-2.348,1.006-2.348s0.872,1.812,0.939,2.415s-0.134,3.153-0.134,3.757c0,0.604-0.738,3.623-0.537,3.824s2.08-2.817,2.349-3.958c0.268-1.141,0.201-3.02,1.408-2.885c1.208,0.134,0.47,2.817,0.402,3.086c-0.066,0.269-0.671,2.349-0.872,2.952s-0.805,1.476-1.006,2.013s0.402,2.349,0,4.629c-0.402,2.281-1.61,5.166-1.61,5.166l0.604,2.08c0,0-1.744,0.671-3.824,0.805C16.443,28.221,14.296,27.885,14.296,27.885z",scale:"0.8"},pen:{title:"Pen",path:"M25.31,2.872l-3.384-2.127c-0.854-0.536-1.979-0.278-2.517,0.576l-1.334,2.123l6.474,4.066l1.335-2.122C26.42,4.533,26.164,3.407,25.31,2.872zM6.555,21.786l6.474,4.066L23.581,9.054l-6.477-4.067L6.555,21.786zM5.566,26.952l-0.143,3.819l3.379-1.787l3.14-1.658l-6.246-3.925L5.566,26.952z",scale:"0.7"},line:{title:"Line",path:"M6.63,21.796l-5.122,5.121h25.743V1.175L6.63,21.796zM18.702,10.48c0.186-0.183,0.48-0.183,0.664,0l1.16,1.159c0.184,0.183,0.186,0.48,0.002,0.663c-0.092,0.091-0.213,0.137-0.332,0.137c-0.121,0-0.24-0.046-0.33-0.137l-1.164-1.159C18.519,10.96,18.519,10.664,18.702,10.48zM17.101,12.084c0.184-0.183,0.48-0.183,0.662,0l2.156,2.154c0.184,0.183,0.184,0.48,0.002,0.661c-0.092,0.092-0.213,0.139-0.334,0.139s-0.24-0.046-0.33-0.137l-2.156-2.154C16.917,12.564,16.917,12.267,17.101,12.084zM15.497,13.685c0.184-0.183,0.48-0.183,0.664,0l1.16,1.161c0.184,0.183,0.182,0.48-0.002,0.663c-0.092,0.092-0.211,0.138-0.33,0.138c-0.121,0-0.24-0.046-0.332-0.138l-1.16-1.16C15.314,14.166,15.314,13.868,15.497,13.685zM13.896,15.288c0.184-0.183,0.48-0.181,0.664,0.002l1.158,1.159c0.183,0.184,0.183,0.48,0,0.663c-0.092,0.092-0.212,0.138-0.332,0.138c-0.119,0-0.24-0.046-0.332-0.138l-1.158-1.161C13.713,15.767,13.713,15.471,13.896,15.288zM12.293,16.892c0.183-0.184,0.479-0.184,0.663,0l2.154,2.153c0.184,0.184,0.184,0.481,0,0.665c-0.092,0.092-0.211,0.138-0.33,0.138c-0.121,0-0.242-0.046-0.334-0.138l-2.153-2.155C12.11,17.371,12.11,17.075,12.293,16.892zM10.302,24.515c-0.091,0.093-0.212,0.139-0.332,0.139c-0.119,0-0.238-0.045-0.33-0.137l-2.154-2.153c-0.184-0.183-0.184-0.479,0-0.663s0.479-0.184,0.662,0l2.154,2.153C10.485,24.036,10.485,24.332,10.302,24.515zM10.912,21.918c-0.093,0.093-0.214,0.139-0.333,0.139c-0.12,0-0.24-0.045-0.33-0.137l-1.162-1.161c-0.184-0.183-0.184-0.479,0-0.66c0.184-0.185,0.48-0.187,0.664-0.003l1.161,1.162C11.095,21.438,11.095,21.735,10.912,21.918zM12.513,20.316c-0.092,0.092-0.211,0.138-0.332,0.138c-0.119,0-0.239-0.046-0.331-0.138l-1.159-1.16c-0.184-0.184-0.184-0.48,0-0.664s0.48-0.182,0.663,0.002l1.159,1.161C12.696,19.838,12.696,20.135,12.513,20.316zM22.25,21.917h-8.67l8.67-8.67V21.917zM22.13,10.7c-0.09,0.092-0.211,0.138-0.33,0.138c-0.121,0-0.242-0.046-0.334-0.138l-1.16-1.159c-0.184-0.183-0.184-0.479,0-0.663c0.182-0.183,0.479-0.183,0.662,0l1.16,1.159C22.312,10.221,22.313,10.517,22.13,10.7zM24.726,10.092c-0.092,0.092-0.213,0.137-0.332,0.137s-0.24-0.045-0.33-0.137l-2.154-2.154c-0.184-0.183-0.184-0.481,0-0.664s0.482-0.181,0.664,0.002l2.154,2.154C24.911,9.613,24.909,9.91,24.726,10.092z",scale:"0.7"},arrow:{title:"Arrow",path:"M21.786,12.876l7.556-4.363l-7.556-4.363v2.598H2.813v3.5h18.973V12.876zM10.368,18.124l-7.556,4.362l7.556,4.362V24.25h18.974v-3.501H10.368V18.124z",scale:"0.7"},circle:{title:"Circle",path:"M16,1.466C7.973,1.466,1.466,7.973,1.466,16 c0,8.027,6.507,14.534,14.534,14.534 c8.027,0,14.534-6.507,14.534-14.534 C30.534,7.973,24.027,1.466,16,1.466z",scale:"0.7"},rect:{title:"Rectangle",path:"M5.5,5.5h20v20h-20z",scale:""},text:{title:"Text",path:"M22.255,19.327l-1.017,0.131c-0.609,0.081-1.067,0.208-1.375,0.382c-0.521,0.293-0.779,0.76-0.779,1.398c0,0.484,0.178,0.867,0.532,1.146c0.354,0.28,0.774,0.421,1.262,0.421c0.593,0,1.164-0.138,1.72-0.412c0.938-0.453,1.4-1.188,1.4-2.229v-1.354c-0.205,0.131-0.469,0.229-0.792,0.328C22.883,19.229,22.564,19.29,22.255,19.327zM8.036,18.273h4.309l-2.113-6.063L8.036,18.273zM28.167,7.75H3.168c-0.552,0-1,0.448-1,1v16.583c0,0.553,0.448,1,1,1h24.999c0.554,0,1-0.447,1-1V8.75C29.167,8.198,28.721,7.75,28.167,7.75zM14.305,23.896l-1.433-4.109H7.488L6,23.896H4.094L9.262,10.17h2.099l4.981,13.727H14.305L14.305,23.896zM26.792,23.943c-0.263,0.074-0.461,0.121-0.599,0.141c-0.137,0.02-0.323,0.027-0.562,0.027c-0.579,0-0.999-0.204-1.261-0.615c-0.138-0.219-0.231-0.525-0.29-0.926c-0.344,0.449-0.834,0.839-1.477,1.169c-0.646,0.329-1.354,0.493-2.121,0.493c-0.928,0-1.688-0.28-2.273-0.844c-0.589-0.562-0.884-1.271-0.884-2.113c0-0.928,0.29-1.646,0.868-2.155c0.578-0.511,1.34-0.824,2.279-0.942l2.682-0.336c0.388-0.05,0.646-0.211,0.775-0.484c0.063-0.146,0.104-0.354,0.104-0.646c0-0.575-0.203-0.993-0.604-1.252c-0.408-0.26-0.99-0.389-1.748-0.389c-0.877,0-1.5,0.238-1.865,0.713c-0.205,0.263-0.34,0.654-0.399,1.174H17.85c0.031-1.237,0.438-2.097,1.199-2.582c0.77-0.484,1.659-0.726,2.674-0.726c1.176,0,2.131,0.225,2.864,0.673c0.729,0.448,1.093,1.146,1.093,2.093v5.766c0,0.176,0.035,0.313,0.106,0.422c0.071,0.104,0.223,0.156,0.452,0.156c0.076,0,0.16-0.005,0.254-0.015c0.093-0.011,0.191-0.021,0.299-0.041L26.792,23.943L26.792,23.943z",scale:""},cut:{title:"Cut",path:"M11.108,10.271c1.083-1.876,0.159-4.443-2.059-5.725C8.231,4.074,7.326,3.825,6.433,3.825c-1.461,0-2.721,0.673-3.373,1.801C2.515,6.57,2.452,7.703,2.884,8.814C3.287,9.85,4.081,10.751,5.12,11.35c0.817,0.473,1.722,0.723,2.616,0.723c0.673,0,1.301-0.149,1.849-0.414c0.669,0.387,1.566,0.904,2.4,1.386c1.583,0.914,0.561,3.861,5.919,6.955c5.357,3.094,11.496,1.535,11.496,1.535L10.75,10.767C10.882,10.611,11.005,10.449,11.108,10.271zM9.375,9.271c-0.506,0.878-2.033,1.055-3.255,0.347C5.474,9.245,4.986,8.702,4.749,8.09C4.541,7.555,4.556,7.035,4.792,6.626c0.293-0.509,0.892-0.801,1.64-0.801c0.543,0,1.102,0.157,1.616,0.454C9.291,6.996,9.898,8.366,9.375,9.271zM17.246,15.792c0,0.483-0.392,0.875-0.875,0.875c-0.037,0-0.068-0.017-0.104-0.021l0.667-1.511C17.121,15.296,17.246,15.526,17.246,15.792zM16.371,14.917c0.037,0,0.068,0.017,0.104,0.021l-0.666,1.51c-0.188-0.16-0.312-0.39-0.312-0.656C15.496,15.309,15.887,14.917,16.371,14.917zM29.4,10.467c0,0-6.139-1.559-11.496,1.535c-0.537,0.311-0.995,0.618-1.415,0.924l4.326,2.497L29.4,10.467zM13.171,17.097c-0.352,0.851-0.575,1.508-1.187,1.859c-0.833,0.481-1.73,0.999-2.399,1.386c-0.549-0.265-1.176-0.414-1.85-0.414c-0.894,0-1.798,0.249-2.616,0.721c-2.218,1.282-3.143,3.851-2.06,5.726c0.651,1.127,1.912,1.801,3.373,1.801c0.894,0,1.799-0.25,2.616-0.722c1.04-0.601,1.833-1.501,2.236-2.536c0.432-1.112,0.368-2.245-0.178-3.189c-0.103-0.178-0.226-0.34-0.356-0.494l3.982-2.3C14.044,18.295,13.546,17.676,13.171,17.097zM9.42,24.192c-0.238,0.612-0.725,1.155-1.371,1.528c-1.221,0.706-2.75,0.532-3.257-0.347C4.27,24.47,4.878,23.099,6.12,22.381c0.514-0.297,1.072-0.453,1.615-0.453c0.749,0,1.346,0.291,1.64,0.8C9.612,23.138,9.628,23.657,9.42,24.192z",scale:"0.7"},undo:{title:"Undo",path:"M12.981,9.073V6.817l-12.106,6.99l12.106,6.99v-2.422c3.285-0.002,9.052,0.28,9.052,2.269c0,2.78-6.023,4.263-6.023,4.263v2.132c0,0,13.53,0.463,13.53-9.823C29.54,9.134,17.952,8.831,12.981,9.073z",scale:"0.7"},redo:{title:"Redo",path:"M12.981,9.073V6.817l-12.106,6.99l12.106,6.99v-2.422c3.285-0.002,9.052,0.28,9.052,2.269c0,2.78-6.023,4.263-6.023,4.263v2.132c0,0,13.53,0.463,13.53-9.823C29.54,9.134,17.952,8.831,12.981,9.073z",scale:"0.7...s-1,1"},clear:{title:"Clear",path:"M20.826,5.75l0.396,1.188c1.54,0.575,2.589,1.44,2.589,2.626c0,2.405-4.308,3.498-8.312,3.498c-4.003,0-8.311-1.093-8.311-3.498c0-1.272,1.21-2.174,2.938-2.746l0.388-1.165c-2.443,0.648-4.327,1.876-4.327,3.91v2.264c0,1.224,0.685,2.155,1.759,2.845l0.396,9.265c0,1.381,3.274,2.5,7.312,2.5c4.038,0,7.313-1.119,7.313-2.5l0.405-9.493c0.885-0.664,1.438-1.521,1.438-2.617V9.562C24.812,7.625,23.101,6.42,20.826,5.75zM11.093,24.127c-0.476-0.286-1.022-0.846-1.166-1.237c-1.007-2.76-0.73-4.921-0.529-7.509c0.747,0.28,1.58,0.491,2.45,0.642c-0.216,2.658-0.43,4.923,0.003,7.828C11.916,24.278,11.567,24.411,11.093,24.127zM17.219,24.329c-0.019,0.445-0.691,0.856-1.517,0.856c-0.828,0-1.498-0.413-1.517-0.858c-0.126-2.996-0.032-5.322,0.068-8.039c0.418,0.022,0.835,0.037,1.246,0.037c0.543,0,1.097-0.02,1.651-0.059C17.251,18.994,17.346,21.325,17.219,24.329zM21.476,22.892c-0.143,0.392-0.69,0.95-1.165,1.235c-0.474,0.284-0.817,0.151-0.754-0.276c0.437-2.93,0.214-5.209-0.005-7.897c0.881-0.174,1.708-0.417,2.44-0.731C22.194,17.883,22.503,20.076,21.476,22.892zM11.338,9.512c0.525,0.173,1.092-0.109,1.268-0.633h-0.002l0.771-2.316h4.56l0.771,2.316c0.14,0.419,0.53,0.685,0.949,0.685c0.104,0,0.211-0.017,0.316-0.052c0.524-0.175,0.808-0.742,0.633-1.265l-1.002-3.001c-0.136-0.407-0.518-0.683-0.945-0.683h-6.002c-0.428,0-0.812,0.275-0.948,0.683l-1,2.999C10.532,8.77,10.815,9.337,11.338,9.512z",scale:"0.8"},palette:{title:"Attributes",path:"M15.653,7.25c-3.417,0-8.577,0.983-8.577,3.282c0,1.91,2.704,3.229,1.691,3.889c-1.02,0.666-2.684-1.848-4.048-1.848c-1.653,0-2.815,1.434-2.815,2.926c0,4.558,6.326,8.25,13.749,8.25c7.424,0,13.443-3.692,13.443-8.25C29.096,10.944,23.077,7.25,15.653,7.25zM10.308,13.521c0-0.645,0.887-1.166,1.98-1.166c1.093,0,1.979,0.521,1.979,1.166c0,0.644-0.886,1.166-1.979,1.166C11.195,14.687,10.308,14.164,10.308,13.521zM14.289,22.299c-1.058,0-1.914-0.68-1.914-1.518s0.856-1.518,1.914-1.518c1.057,0,1.914,0.68,1.914,1.518S15.346,22.299,14.289,22.299zM19.611,21.771c-1.057,0-1.913-0.681-1.913-1.519c0-0.84,0.856-1.521,1.913-1.521c1.059,0,1.914,0.681,1.914,1.521C21.525,21.092,20.67,21.771,19.611,21.771zM20.075,10.66c0-0.838,0.856-1.518,1.914-1.518s1.913,0.68,1.913,1.518c0,0.839-0.855,1.518-1.913,1.518C20.934,12.178,20.075,11.499,20.075,10.66zM24.275,19.482c-1.057,0-1.914-0.681-1.914-1.519s0.857-1.518,1.914-1.518c1.059,0,1.914,0.68,1.914,1.518S25.334,19.482,24.275,19.482zM25.286,15.475c-1.058,0-1.914-0.68-1.914-1.519c0-0.838,0.856-1.518,1.914-1.518c1.057,0,1.913,0.68,1.913,1.518C27.199,14.795,26.343,15.475,25.286,15.475z",scale:""}},s=4;for(var c in i){var l=r(o,c,{x:s-4,y:0,width:o.height,height:o.height,title:i[c].title,fill:"rgba(0,0,0,0)",stroke:"none"});l.addIcon(i[c].path,{fill:"90-#888-#CCC",stroke:"none",transform:"t"+s+",4"+(""!=i[c].scale?"s"+i[c].scale:"")}),l.hover(function(){e.options.editable&&!this.isSelected&&"undo"!=this.name&&"redo"!=this.name&&this.highlight(!0,!1)},function(){e.options.editable&&!this.isSelected&&"undo"!=this.name&&"redo"!=this.name&&this.highlight(!1,!1)}),l.mouseDown(function(){if(e.options.editable&&!this.isSelected)switch(this.name){case"undo":case"redo":break;case"clear":this.select(!0);break;case"palette":e.canvas.container.unbind("mouseenter"),this.select(!0);break;default:e.toolBar.deselectAll(),e.getMode!=this.name&&e.setMode(this.name)}}),l.mouseUp(function(){if(e.options.editable)switch(this.name){case"undo":w(e,"before_undo")&&e.undo(),w(e,"after_undo");break;case"redo":w(e,"before_redo")&&e.redo(),w(e,"after_redo");break;case"clear":this.select(!1),this.highlight(!0,!1),w(e,"before_clear")&&e.clear(),w(e,"after_clear");break;case"palette":e.attributesPanel.show(),this.select(!1),this.highlight(!0,!0);break;default:}}),o.addButton(l),s+=o.height}return o},height:function(){return this.height},background:function(){return this.background},buttons:function(){return this.buttons},addButton:function(t){this.buttons.push(t)},insertButton:function(t,e){this.buttons.splice(e,1,t)},removeButton:function(e){var r=this;r.buttons.splice(t.inArray(e,r.buttons),1),e.set.clear()},button:function(t){var e=this;for(idx in e.buttons)if(e.buttons[idx].name==t)return e.buttons[idx]},deselectAll:function(){var t=this,e=t.buttons;for(idx in e)"undo"!=e[idx].name&&"redo"!=e[idx].name&&e[idx].select(!1)},enabled:function(t){var e=this;e.isEnabled=t,t||e.deselectAll();var r=e.buttons;for(idx in r)r[idx].enabled(t)}},Y={init:function(e,r){var a=this;a.container=t("#"+r),a.container.css({position:"relative",width:e.width()+"px",height:e.height()-(e.options.showToolBar?e.toolBar.height:0)+"px"}),a.paper=Raphael(r,e.width(),e.height()-(e.options.showToolBar?e.toolBar.height:0));var o=a.container.children(":first");return"relative"==o.css("position")&&(o.css("left",""),o.css("top","")),a}},E={init:function(e,r){var a=this;a.RB=e,a.container=t("#"+r),a.container.css({position:"relative",top:"-"+a.RB.height()+"px",width:a.RB.width()+"px",height:a.RB.height()+"px","z-index":"9999",display:"none"}),a.paper=Raphael(r,e.width(),e.height());var o=a.container.children(":first");return"relative"==o.css("position")&&(o.css("left",""),o.css("top","")),a},show:function(){var e=this,r=["#000","#FFF","#F00","#0F0","#00F","#FF0"],a=e.RB.width(),o=e.RB.height();e.container.css({top:"-"+o+"px",width:a+"px",height:o+"px"}),e.panel=e.paper.set(),e.panel.push(e.paper.rect(0,0,a,o).attr({fill:"rgba(0,0,0,0.25)",stroke:"none",cursor:"auto"})),e.panel.push(e.paper.rect(a/2-110,o/2-110,220,220,16).attr({fill:"rgba(0,0,0,0.5)",stroke:"none"}));var n=e.paper.circle(a/2,o/2,90).attr({fill:e.RB.options.fill,stroke:e.RB.options.stroke,"stroke-width":e.RB.options.strokeWidth,cursor:"pointer"});e.panel.push(n);for(var i=e.paper.set(),s=0,c=0;360>c;){var l=r[s];(function(t,r){i.push(e.paper.circle(a/2,o/2+40,16).attr({stroke:r,fill:r,transform:t,cursor:"pointer"}).click(function(){n.attr({fill:this.attr("fill")})}))})("r"+c+" "+a/2+" "+o/2,l),s++,c+=60}var h=e.paper.set(),p=e.paper.circle(a/2,o/2,16).attr({fill:"rgba(0,0,0,0)",stroke:"none"});h.push(p),h.push(e.paper.path("M11.478,17.568c-0.172-0.494-0.285-1.017-0.285-1.568c0-2.65,2.158-4.807,4.807-4.807c0.552,0,1.074,0.113,1.568,0.285l2.283-2.283C18.541,8.647,17.227,8.286,16,8.286C8.454,8.286,2.5,16,2.5,16s2.167,2.791,5.53,5.017L11.478,17.568zM23.518,11.185l-3.056,3.056c0.217,0.546,0.345,1.138,0.345,1.76c0,2.648-2.158,4.807-4.807,4.807c-0.622,0-1.213-0.128-1.76-0.345l-2.469,2.47c1.327,0.479,2.745,0.783,4.229,0.783c5.771,0,13.5-7.715,13.5-7.715S26.859,13.374,23.518,11.185zM25.542,4.917L4.855,25.604L6.27,27.02L26.956,6.332L25.542,4.917z").attr({fill:"#FFF",stroke:"#000",transform:"t"+(a/2-16)+","+(o/2-16)})),h.attr({cursor:"pointer"}).hover(function(){p.attr({fill:"rgba(255,255,255,0.5)"})},function(){p.attr({fill:"rgba(0,0,0,0)"})}).click(function(){n.attr({fill:"none"}),0==n.attr("stroke-width")&&n.attr({"stroke-width":1})}),i.push(h);for(var s=0,c=105;270>c;){var l=r[s];(function(t,r){e.panel.push(e.paper.circle(a/2,o/2+90,16).attr({stroke:r,fill:r,transform:t,cursor:"pointer"}).click(function(){n.attr({stroke:this.attr("fill")})}))})("r"+c+" "+a/2+" "+o/2,l),s++,c+=30}for(var c=300,u=12;420>=c;){var l="#000";(function(t,r,i){var s=e.paper.set(),c=e.paper.circle(a/2,o/2+90,16).attr({stroke:"none",fill:"#C0C0C0"});if(s.push(c),i>0&&s.push(e.paper.circle(a/2,o/2+90,i/2).attr({stroke:"none",fill:r})),s.attr({stroke:"rgba(0,0,0,0)","stroke-width":0==i?0:i/2,transform:t,cursor:"pointer"}),0==i){var l=c.getBBox(!1);s.push(e.paper.path("M11.478,17.568c-0.172-0.494-0.285-1.017-0.285-1.568c0-2.65,2.158-4.807,4.807-4.807c0.552,0,1.074,0.113,1.568,0.285l2.283-2.283C18.541,8.647,17.227,8.286,16,8.286C8.454,8.286,2.5,16,2.5,16s2.167,2.791,5.53,5.017L11.478,17.568zM23.518,11.185l-3.056,3.056c0.217,0.546,0.345,1.138,0.345,1.76c0,2.648-2.158,4.807-4.807,4.807c-0.622,0-1.213-0.128-1.76-0.345l-2.469,2.47c1.327,0.479,2.745,0.783,4.229,0.783c5.771,0,13.5-7.715,13.5-7.715S26.859,13.374,23.518,11.185zM25.542,4.917L4.855,25.604L6.27,27.02L26.956,6.332L25.542,4.917z").attr({fill:"#000",stroke:"rgba(0,0,0,0)","stroke-width":0==i?0:i/2,transform:"t"+l.x+","+l.y}))}s.click(function(){i=this.attr("stroke-width"),0==i?"none"==n.attr("fill")&&n.attr({fill:e.RB.options.fill}):i=1==i?1:2*i,n.attr({"stroke-width":i})}),e.panel.push(s)})("r"+c+" "+a/2+" "+o/2,l,u),c+=30,u-=4,0>u?u=0:0==u&&(u=2)}var f=e.paper.circle(a/2-90,o/2+90,16).attr({fill:"rgba(0,0,0,0)",stroke:"none"}),h=e.paper.set();h.push(f),h.push(e.paper.path("M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z").attr({fill:"#F00",stroke:"none",transform:"t"+(a/2-90-16)+","+(o/2+90-16)})),h.attr({cursor:"pointer"}).hover(function(){f.attr({fill:"rgba(255,0,0,0.25)"})},function(){f.attr({fill:"rgba(0,0,0,0)"})}).click(function(){e.hide(),e.RB.canvas.container.mousemove(g(e.RB.canvas.container)),e.RB.canvas.container.unbind("mousemove")}),e.panel.push(h);var d=e.paper.circle(a/2+90,o/2+90,16).attr({fill:"rgba(0,0,0,0)",stroke:"none"}),h=e.paper.set();h.push(d),h.push(e.paper.path("M2.379,14.729 5.208,11.899 12.958,19.648 25.877,6.733 28.707,9.561 12.958,25.308z").attr({fill:"#0F0",stroke:"none",transform:"t"+(a/2+90-16)+","+(o/2+90-16)})),h.attr({cursor:"pointer"}).hover(function(){d.attr({fill:"rgba(0,255,0,0.25)"})},function(){d.attr({fill:"rgba(0,0,0,0)"})}).click(function(){e.RB.options.stroke=n.attr("stroke"),e.RB.options.fill=n.attr("fill"),e.RB.options.strokeWidth=n.attr("stroke-width"),e.hide(),e.RB.canvas.container.mousemove(g(e.RB.canvas.container)),e.RB.canvas.container.unbind("mousemove")}),e.panel.push(h),e.panel.attr({cursor:"pointer"}),t(e.container).show()},hide:function(){var e=this;t(e.container).hide(),e.paper.clear()}},X="r_b-toolbar",H="r_b-paper",V="r_b-overlay",A={init:function(e,r){var i=this;if(i.version="1.0.0",i.UUID=Raphael.createUUID(),i.elem=r,i.$elem=t(r),e&&e.strokeWidth)switch(e.strokeWidth){case"medium":e.strokeWidth=4;break;case"big":e.strokeWidth=8;break;case"huge":e.strokeWidth=12;break;default:e.strokeWidth=1}i.options=t.extend({},t.fn.RaphBoard.options,e),i.eventHandlers={before_mode_change:null,after_mode_change:null,before_start:null,after_start:null,before_change:null,after_change:null,before_end:null,after_end:null,before_cut:null,after_cut:null,before_undo:null,after_undo:null,before_redo:null,after_redo:null,before_clear:null,after_clear:null},i.options.showToolBar&&(i.$elem.append("<div id='"+X+"'/>"),i.toolBar=a(i,X)),i.$elem.append("<div id='"+H+"'/>"),i.canvas=o(i,H),i.paper=i.canvas.paper,i.shapes=[],i.undoBuffer=[],i.redoBuffer=[],i.setMode("pen"),i.$elem.append("<div id='"+V+"'/>"),i.attributesPanel=n(i,V),i.mouseDownX=0,i.mouseDownY=0,i.canvas.container.mouseenter(x)},left:function(){return this.$elem.offset().left},top:function(){return this.$elem.offset().top},width:function(){return this.$elem.width()},height:function(){return this.$elem.height()},on:function(e,r){return self=this,t.each(self.eventHandlers,function(t){return(t=e)?(self.eventHandlers[e]=r,!1):undefined}),self},off:function(e){return self=this,t.each(self.eventHandlers,function(t){return(t=e)?(self.eventHandlers[e]=null,!1):undefined}),self},enabled:function(t){var e=this;return e.options.editable=t,e.options.showToolBar&&(e.toolBar.enabled(t),t&&e.toolBar.button(e.getMode()).select(!0)),e},setMode:function(t){var e=this;return w(e,"before_mode_change")&&(c(e),e.mode=t,e.options.editable&&e.options.showToolBar&&(e.toolBar.deselectAll(),e.toolBar.button(t).select(!0)),i(e)),w(e,"after_mode_change"),e},getMode:function(){return this.mode},getById:function(e){var r,a=this;return t.each(a.shapes,function(t,a){return a.id==e?(r=a,!1):undefined}),r},move:function(e,r,a){var o=this,n=o.getById(e),i=o.options.animation;if(n){v(n);var s=r-n.ox,c=a-n.oy;if(i){switch(n.type){case"path":var l={transform:"t"+(parseInt(n.ox)+parseInt(s))+","+(parseInt(n.oy)+parseInt(c))};break;case"circle":case"ellipse":var l={cx:n.ox+s,cy:n.oy+c};break;default:var l={x:n.ox+s,y:n.oy+c}}n.animate(Raphael.animation(t.extend({},i.params,l),i.ms,i.easing))}b(o,n,s,c),z(o,"move",n)}},line:function(t,e,r,a){var o=this;if(0!=r||0!=a){var n=D(o,t,e);return n.attr("path","M"+t+","+e+"L"+r+","+a),o.shapes.push(n),z(o,"line",n),n}return null},arrow:function(t,e,r,a){var o=this;if(0!=r||0!=a){var n=D(o,t,e);return n.attr("path","M"+t+","+e+"L"+r+","+a),o.shapes.push(n),z(o,"arrow",n),n}return null},circle:function(t,e,r){var a=this;if(0!=r){var o=S(a,t,e);return o.attr("r",r),a.shapes.push(o),z(a,"circle",o),o}return null},ellipse:function(t,e,r,a){var o=this;if(0!=r||0!=a){var n=I(o,t,e);return n.attr("rx",r).attr("ry",a),o.shapes.push(n),z(o,"ellipse",n),n}return null},rect:function(t,e,r,a){var o=this;if(0!=r||0!=a){var n=F(o,t,e);return n.attr("dx",r).attr("dy",a),o.shapes.push(n),z(o,"rect",n),n}return null},text:function(t,e,r,a){var o=this;if(r&&""!=r){if(a&&!isNaN(a)){var n=Math.abs(parseInt(a));o.options.fontSize=0==n?12:n}var i=W(o,t,e,r);return o.shapes.push(i),z(o,"text",i),w(o,"after_end"),i}return null},cut:function(t){var e=this,r=e.shapes;if(r.length>0)for(var a=0;r.length>a;a++)if(r[a].id==t){z(e,"cut",r[a]),r[a].remove(),r.splice(a,1);break}},toJSON:function(t,e){for(var r,a=[],o=this.paper,n=o.bottom;null!=n;n=n.next)r=e?e(n,{}):{},r&&a.push({data:r,type:n.type,attrs:n.attrs,transform:n.matrix.toTransformString(),id:n.id});return JSON.stringify(a)},fromJSON:function(t,e){var r,a=this;r="string"==typeof t?JSON.parse(t):t;for(var o in r)if(r.hasOwnProperty(o)){var n=O(a,r[o].shape);e&&e(n),z(a,r[o].command,n)}},canUndo:function(){return this.undoBuffer.length>0},undo:function(){var t=this;if(t.canUndo()){var e=t.shapes,r=t.undoBuffer;t.paper;var a=r.pop(),o=a.command;switch(c(t),o){case"move":for(var n=null,s=r.length-1;s>=0;s--)if(n=r[s].shape,n.id==a.shape.id){var l,h;
switch(n.type){case"path":var p=n.transform.replace("t","").split(",");l=p[0]?p[0]:0,h=p[1]?p[1]:0;break;case"circle":case"ellipse":l=n.attrs.cx,h=n.attrs.cy;break;default:l=n.attrs.x,h=n.attrs.y}t.move(n.id,l,h),t.undoBuffer.pop();break}break;case"cut":O(t,a.shape);break;case"clear":for(var s=0;a.shapes.length>s;s++)O(t,a.shapes[s]);break;default:e.pop().remove()}switch(t.redoBuffer.push(a),o){case"undo":case"redo":case"clear":break;default:t.setMode(o),i(t)}}return t.indicateUndoRedo(),t},clearUndo:function(){var t=this;t.undoBuffer=[],t.indicateUndoRedo()},canRedo:function(){return this.redoBuffer.length>0},redo:function(){var t=this;if(t.canRedo()){t.shapes;var e=t.redoBuffer;t.paper;var r=e.pop(),a=r.command,o=r.shape;switch(c(t),a){case"move":var n,s;switch(o.type){case"path":var l=o.transform.replace("t","").split(",");n=l[0]?l[0]:0,s=l[1]?l[1]:0;break;case"circle":case"ellipse":n=o.attrs.cx,s=o.attrs.cy;break;default:n=o.attrs.x,s=o.attrs.y}t.move(o.id,n,s);break;case"cut":t.cut(o.id);break;case"clear":t.clear();break;default:O(t,o),t.undoBuffer.push(r)}switch(a){case"undo":case"redo":case"clear":break;default:t.setMode(a),i(t)}}return t.indicateUndoRedo(),t},clearRedo:function(){var t=this;t.redoBuffer=[],t.indicateUndoRedo()},indicateUndoRedo:function(){var t=this;if(t.options.showToolBar){var e=t.toolBar.button("undo"),r=t.toolBar.button("redo");t.canUndo()?e.activeIcon().path.attr({fill:"90-#BBF1B2-#5D9E54",stroke:"none"}):e.activeIcon().path.attr({fill:"90-#888-#CCC",stroke:"none"}),e.enabled(t.canUndo()),t.canRedo()?r.activeIcon().path.attr({fill:"90-#BBF1B2-#5D9E54",stroke:"none"}):r.activeIcon().path.attr({fill:"90-#888-#CCC",stroke:"none"}),r.enabled(t.canRedo())}},clear:function(){var t=this;if(t.shapes.length>0){c(t);for(var e=[],r=0;t.shapes.length>r;r++)e.push(R(t.shapes[r]));t.undoBuffer.push({command:"clear",shapes:e}),t.shapes=[],t.paper.clear()}return t.clearRedo(),t},flush:function(){self=this,c(self),self.shapes=[],self.paper.clear(),self.clearUndo(),self.clearRedo()}};t.fn.RaphBoard=function(e,r){var a=t(this).data("RaphBoard");if(a){if(!e)return a;if("object"==typeof e)a.options=t.extend({},t.fn.RaphBoard.options,e);else if("string"==typeof e)switch(e){case"options":return r?a.options[r]:a.options;default:return a}}else a=Object.create(A),a.init(e,this),t.data(this.get(0),"RaphBoard",a);return a},t.fn.RaphBoard.options={editable:!0,showToolBar:!0,fill:"#FFF",stroke:"#FFF",strokeWidth:1,lineCap:"round",lineJoin:"round",arrowEnd:"classic-medium-medium",fontSize:12,textAnchor:"start",animation:{params:{},ms:100,easing:"<>"}}}(jQuery,window,document);