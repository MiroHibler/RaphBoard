/*! ┌─────────────────────────────────────────────────────────────────────────────────────────────┐ */
/*! │ RaphBoard v1.1.0 - Cross-browser drawing board based on Raphaël                             │ */
/*! ├─────────────────────────────────────────────────────────────────────────────────────────────┤ */
/*! │ Copyright © 2012-2013 Miroslav Hibler (http://MiroHibler.github.com/RaphBoard/)             │ */
/*! ├─────────────────────────────────────────────────────────────────────────────────────────────┤ */
/*! │ Licensed under the MIT license (http://opensource.org/licenses/mit-license.php).            │ */
/*! ├─────────────────────────────────────────────────────────────────────────────────────────────┤ */
/*! │ Requirements: jQuery  (http://jquery.com)                                                   │ */
/*! |               Raphaël (http://raphaeljs.com)                                                │ */
/*! │               Raphaël FreeTransform (http://alias.io/raphael/free_transform/)               │ */
/*! └─────────────────────────────────────────────────────────────────────────────────────────────┘ */
"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),function(e,t,r,n){function a(e,t,r){return Object.create(V).init(e,t,r)}function o(e,t,r){return Object.create(N).init(e,t,r)}function i(e,t){return Object.create(P).init(e,t)}function s(e){var t=this;for(idx in t._buttons)e?t._buttons[idx].enable():t._buttons[idx].disable()}function c(e,t){return Object.create($).init(e,t)}function l(e,t){return Object.create(G).init(e,t)}function u(e,t){e.options.editable&&e.elements.map(function(r){r.id!==(t?t.id:-1)&&d(e,r,e._mode)})}function d(e,t,r){switch(r){case"move":null==t.freeTransform&&e.initMove(t.id,!0),t.attr({cursor:"pointer"});break;case"text":t.attr({cursor:"text"});break;case"cut":t.hover(w,y),t.attr({cursor:"pointer"});break;case"pen":case"line":case"arrow":case"circle":case"ellipse":case"rect":t.attr({cursor:"crosshair"});break;default:}}function h(e,t){e.options.editable&&e.elements.map(function(r){switch(r.id!==(t?t.id:-1)?f(r,!0):f(r),e._mode){case"move":case"cut":r.attr({cursor:"pointer"});break;case"text":r.attr({cursor:"text"});break;default:r.attr({cursor:"crosshair"})}})}function f(e,t){if(e.events)for(var r=e.events.length,n=0;r>n;n++)switch(e.events[n].f){case w:case x:case y:case D:case R:case U:e["un"+e.events[n].name](e.events[n].f),r=e.events?e.events.length:0,n--;break;default:}e.freeTransform&&!t&&e.freeTransform.unplug()}function p(e,t){var r=!1;return e.paper.freeTransform(t,{animate:!1,attrs:{fill:"#bada55",stroke:"#000"},drag:["center","self"],draw:"circle"===t.type?["bbox"]:["circle","bbox"],keepRatio:"circle"===t.type?!0:!1,rotate:"circle"===t.type?!1:["axisX"],scale:["bboxCorners","bboxSides"],size:{axes:5,bboxCorners:5,bboxSides:5,center:5}},function(a,o){switch(o[0]){case"init":r=!1;break;case"drag start":a.hideHandles({undrag:!1}),t.attr({cursor:"move"});break;case"drag end":a.showHandles(),t.attr({cursor:"pointer"});break;case"rotate start":a.handles.center&&a.handles.center.disc.hide(),a.bbox&&(a.bbox.hide(),a.handles.bbox&&a.handles.bbox.map(function(e){e.element.hide()})),t.attr({cursor:"pointer"});break;case"rotate end":a.handles.center&&a.handles.center.disc.show(),a.bbox&&(a.bbox.show(),a.handles.bbox&&a.handles.bbox.map(function(e){e.element.show()})),t.attr({cursor:"pointer"});break;case"scale start":if(a.handles.center&&a.handles.center.disc.hide(),["x","y"].map(function(e){a.handles[e]&&(a.handles[e].disc.hide(),a.handles[e].line.hide())}),a.bbox){var i;e.paper.getElementsByPoint(a.o.handlePos.cx,a.o.handlePos.cy).forEach(function(e){return"rect"===e.type?(i=e.id,!1):n}),a.handles.bbox&&a.handles.bbox.map(function(e){i!==e.element.id&&e.element.hide()})}a.circle&&a.circle.hide();break;case"scale end":a.handles.center&&a.handles.center.disc.show(),["x","y"].map(function(e){a.handles[e]&&(a.handles[e].disc.show(),a.handles[e].line.show())}),a.bbox&&a.handles.bbox&&a.handles.bbox.map(function(e){e.element.show()}),a.circle&&a.circle.show(),t.attr({cursor:"pointer"});break;default:r=!0}switch(o[0].split(" ")[1]){case"start":z(e,"before_move")&&(k(e,t),I(e,e._mode,t));break;case"end":var s=e.undoBuffer.pop();r&&(s.element.data.ft.attrs=T(e,t),delete s.element.attrs.cursor,e.undoBuffer.push(s),e.clearRedo(),r=!1),z(e,"after_move");break;default:}})}function m(e,t){return z(e,"before_select")&&(t.attr({cursor:"move"}),e.select(t.id)),z(e,"after_select"),t}function b(e,t){return e.elements.map(function(r){r.id!==(t?t.id:-1)&&_(e,r)}),t}function _(e,t){return z(e,"before_deselect")&&e.deselect(t.id),z(e,"after_deselect"),t}function v(e,t){if(z(e,"before_show_handles")&&t.freeTransform){var r=t.freeTransform;r.handles.center&&r.handles.center.disc.show(),r.bbox&&(r.bbox.show(),r.handles.bbox&&r.handles.bbox.map(function(e){e.element.show()})),["x","y"].map(function(e){r.handles[e]&&(r.handles[e].disc.show(),r.handles[e].line.show())}),r.circle&&r.circle.show()}return z(e,"after_show_handles"),t}function k(e,t){var r=e.elements;return r.map(function(r){r.id!==(t?t.id:-1)&&g(e,r)}),t}function g(e,t){if(z(e,"before_hide_handles")&&t.freeTransform){var r=t.freeTransform;r.handles.center&&r.handles.center.disc.hide(),r.bbox&&(r.bbox.hide(),r.handles.bbox&&r.handles.bbox.map(function(e){e.element.hide()})),["x","y"].map(function(e){r.handles[e]&&(r.handles[e].disc.hide(),r.handles[e].line.hide())}),r.circle&&r.circle.hide()}return z(e,"after_hide_handles"),t}function w(){var t=this,r=e(t.node),n=r.parent().parent().parent().data("RaphBoard");t.mousedown(x),B(n,t)}function x(){var t=this,r=e(t.node),n=r.parent().parent().parent().data("RaphBoard");z(n,"before_cut")&&(f(t),C(n,t),n.cut(t.id)),z(n,"after_cut")}function y(){var t=this,r=e(t.node),n=r.parent().parent().parent().data("RaphBoard");t.unmousedown(x),C(n,t)}function B(e,t){e.cutStroke=t.attr("stroke"),e.cutStrokeWidth=t.attr("stroke-width"),e.cutStrokeDash=t.attr("stroke-dasharray"),"path"!=t.type&&"none"!=t.attr("fill")&&(e.cutFill=t.attr("fill"),e.cutOpacity=t.attr("fill-opacity"),t.attr({fill:"#F00","fill-opacity":1})),t.attr({stroke:"#F00","stroke-width":1,"stroke-dasharray":"-"}),"path"!=t.type&&"none"!=t.attr("fill")&&t.animate({"fill-opacity":.5},100)}function C(e,t){"path"!=t.type&&"none"!=t.attr("fill")&&t.animate({"fill-opacity":e.cutOpacity},100).attr({fill:e.cutFill,"fill-opacity":e.cutOpacity}),t.attr({stroke:e.cutStroke,"stroke-width":e.cutStrokeWidth,"stroke-dasharray":e.cutStrokeDash})}function M(e){var t=e.parent().data("RaphBoard");switch(t._mode){case"move":case"cut":e.css({cursor:"pointer"});break;case"text":e.css({cursor:"text"});break;default:e.css({cursor:"crosshair"})}e.unbind("mouseenter").mouseleave(F),"cut"!=t._mode&&e.mousedown(D)}function z(e,t){var r=e.eventHandlers[t];return r?r(e):!0}function S(t){var r=e(t.delegateTarget),n=r.parent().data("RaphBoard");n.options.editable&&M(r)}function D(t){t.originalEvent.preventDefault();var r=e(t.delegateTarget),n=r.parent().data("RaphBoard");if(n.mouseDownX=t.pageX-n.left(),n.mouseDownY=t.pageY-n.top()-(n.toolBar?n.toolBar.height():0),z(n,"before_start")){var a=n.elements;switch(n._mode){case"pen":a.push(W(n,n.mouseDownX,n.mouseDownY));break;case"line":a.push(W(n,n.mouseDownX,n.mouseDownY));break;case"arrow":a.push(W(n,n.mouseDownX,n.mouseDownY).attr({"arrow-end":n.options.arrowEnd}));break;case"circle":a.push(j(n,n.mouseDownX,n.mouseDownY));break;case"ellipse":a.push(A(n,n.mouseDownX,n.mouseDownY));break;case"rect":a.push(H(n,n.mouseDownX,n.mouseDownY));break;case"text":X(n,n.mouseDownX,n.mouseDownY);break;default:var o=n.paper.getElementByPoint(t.pageX,t.pageY);null==o&&(b(n),n.multiSelect=H(n,n.mouseDownX,n.mouseDownY),n.multiSelect.attr({fill:"#bada55","fill-opacity":.1,stroke:"#bada55","stroke-width":1,"stroke-dasharray":"-"}))}"text"!=n._mode&&"cut"!=n._mode&&(("move"!=n._mode||null!=n.multiSelect)&&r.mousemove(R),r.mouseup(U))}z(n,"after_start")}function R(t){var r=e(t.delegateTarget),n=r.parent().data("RaphBoard");if(z(n,"before_change")){var a=n.elements[n.elements.length-1],o=t.pageX-n.left(),i=t.pageY-n.top()-(n.toolBar?n.toolBar.height():0),s=o-n.mouseDownX,c=i-n.mouseDownY;switch(n._mode){case"pen":a.attr("path",a.attr("path")+"L"+o+","+i);break;case"line":a.attr("path","M"+n.mouseDownX+" "+n.mouseDownY+"L"+o+","+i);break;case"arrow":a.attr("path","M"+n.mouseDownX+" "+n.mouseDownY+"L"+o+","+i);break;case"circle":a.attr("r",Math.max(Math.abs(s),Math.abs(c)));break;case"ellipse":a.attr("rx",Math.abs(s)).attr("ry",Math.abs(c));break;case"rect":0>s&&a.attr("x",o),0>c&&a.attr("y",i),a.attr("width",Math.abs(s)).attr("height",Math.abs(c));break;case"text":break;default:n.multiSelect&&(0>s&&n.multiSelect.attr("x",o),0>c&&n.multiSelect.attr("y",i),n.multiSelect.attr("width",Math.abs(s)).attr("height",Math.abs(c)))}}z(n,"after_change")}function U(t){var r=e(t.delegateTarget),n=r.parent().data("RaphBoard");if(n.mouseUpX=t.pageX-n.left(),n.mouseUpY=t.pageY-n.top()-(n.toolBar?n.toolBar.height():0),z(n,"before_end")){switch(n._mode){case"cut":case"text":break;case"move":if(n.multiSelect){var a=n.multiSelect.getBBox();n.multiSelect.remove(),n.multiSelect=null,0!==a.width&&0!==a.height&&n.elements.map(function(e){Raphael.isBBoxIntersect(a,e.getBBox())&&m(n,e)})}u(n);break;default:var o=n.elements;element=o.pop();var a=element.getBBox();0==a.width&&0==a.height?element.remove():(o.push(element),I(n,n._mode,element))}"text"!=n._mode&&"cut"!=n._mode&&r.unbind("mousemove").unbind("mouseup")}z(n,"after_end")}function F(t){t.stopPropagation();var r=e(t.delegateTarget);r.unbind("mouseleave").removeClass("cursor-*");var n=r.parent().data("RaphBoard");"cut"!=n._mode&&r.unbind("mousedown"),r.mouseenter(S)}function O(e,t){for(var r=e.length-1;r>=0;r--){var n=e[r].element;if(n.id==t)return n}return null}function I(e,t,r){var r={command:t,element:E(e,r)};switch(e.undoBuffer.push(r),t){case"cut":case"clear":case"move":case"modify":case"transform":break;default:e.clearRedo()}}function L(e,t,r){var n=!1,a=t.freeTransform;return a||(n=!0,a=e.paper.freeTransform(t).setOpts({animate:e.options.animation})),a.attrs=JSON.parse(JSON.stringify(r)),a.apply(),n&&a.unplug(),t}function T(e,t){var r,n=!1,a=t.freeTransform;return a||(n=!0,a=e.paper.freeTransform(t)),r=JSON.parse(JSON.stringify(a.attrs)),n&&a.unplug(),r}function E(e,t){var r={data:{ft:{attrs:T(e,t)}},id:t.id,type:t.type,attrs:JSON.parse(JSON.stringify(t.attrs)),transform:t.matrix.toTransformString()};return delete r.attrs.transform,r}function W(e,t,r){var n=e.paper.path("M"+t+" "+r);return 0==e.options.strokeWidth&&(e.options.stroke=e.options.fill,e.options.strokeWidth=1),n.attr({stroke:e.options.stroke,"stroke-width":e.options.strokeWidth,"stroke-linecap":e.options.lineCap,"stroke-linejoin":e.options.lineJoin}),n}function j(e,t,r){var n=e.paper.circle(t,r,0);return n.attr({fill:e.options.fill,stroke:e.options.stroke,"stroke-width":e.options.strokeWidth,"stroke-linecap":e.options.lineCap,"stroke-linejoin":e.options.lineJoin}),n}function A(e,t,r){var n=e.paper.ellipse(t,r,0,0);return n.attr({fill:e.options.fill,stroke:e.options.stroke,"stroke-width":e.options.strokeWidth,"stroke-linecap":e.options.lineCap,"stroke-linejoin":e.options.lineJoin}),n}function H(e,t,r){var n=e.paper.rect(t,r,0,0);return n.attr({fill:e.options.fill,stroke:e.options.stroke,"stroke-width":e.options.strokeWidth,"stroke-linecap":e.options.lineCap,"stroke-linejoin":"miter"}),n}function X(e,t,r){var n=prompt("Please enter text:\nOptionally, you can specify text size by\nprepending text size as number enclosed in {}","{"+e.options.fontSize+"}Write some text here...");if(n&&""!=n){var a=e.options.fontSize;return"{"==n[0]&&(a=n.substring(1,n.indexOf("}")),n=n.substring(n.indexOf("}")+1)),e.text(t,r,n,a)}}function Y(e,t,r,n){var a=e.paper.text(t,r,n),o=e.options;return a.attr({fill:o.fill,stroke:o.stroke,"stroke-width":o.strokeWidth,"stroke-linecap":o.lineCap,"stroke-linejoin":o.lineJoin,"font-size":o.fontSize}),o.font&&a.attr({font:'"'+o.fontSize+'px "'+o.font+'"'}),o.fontFamily&&a.attr({"font-family":o.fontFamily}),o.fontStyle&&a.attr({"font-style":o.fontStyle}),o.fontWeight&&a.attr({"font-weight":o.fontWeight}),o.textAnchor&&a.attr({"text-anchor":o.textAnchor}),o.textDecoration&&a.attr({"text-decoration":o.textDecoration}),a}function J(e,t){var r,n,a=e.elements,o=t.attrs;switch(t.type){case"circle":r=e.paper.circle(o.cx,o.cy,o.r);break;case"ellipse":r=e.paper.ellipse(o.cx,o.cy,o.rx,o.ry);break;case"rect":r=e.paper.rect(o.x,o.y,o.width,o.height);break;case"text":r=e.paper.text(o.x,o.y,o.text);break;default:r=e.paper.path("")}r.id=t.id,r.node.raphaelid=t.id,r.attr(o),r.transform(t.transform);for(var i=a.length-1;i>=0;i--)if(r.id>a[i].id){n=a[i].id;break}return n?(r.insertAfter(e.paper.getById(n)),a.splice(i+1,0,r)):a.push(r),r}var V={init:function(e,t,r){var n=this;return n._button=e,n._path=e._toolBar._paper.path(t).attr(r),n},isGlowing:function(){return"object"==typeof this._path._glow},isVisible:function(){return"none"!==this._path.node.style.display},glow:function(e){var t=this;return e?t._path._glow=t._path.glow():t.isGlowing()&&t._path._glow.remove(),t},show:function(){var e=this;return e._path.show(),e},hide:function(){var e=this;return e._path.hide(),e}},N={init:function(e,t,r){var n=this;n._toolBar=e,n._name=t,n._icons=[],n._isEnabled=!0,n._isSelected=!1;var a=e._paper;return n._set=a.set(),n._paths=a.set(),n._set.push(n._paths),n._rect=a.rect(0,0,0,0).attr(r),n._set.push(n._rect),n},isEnabled:function(){return this._isEnabled},isVisible:function(){return this._isVisible},isSelected:function(){return this._isSelected},name:function(e){var t=this;return e!==n&&(t._name=e),t._name},attr:function(t){var r=this;return"Object"==typeof t&&r._rect.attr(e.extend({},r._rect.attr(),t)),r._rect.attr()},activeIcon:function(){var e,t=this;for(ndx in t._icons)if(t._icons[ndx].isVisible()){e=t._icons[ndx];break}return e},hover:function(e,t){var r=this;return r._mouseIn=e,r._mouseOut=t,r._rect.hover(function(){r._isEnabled&&r._mouseIn()},function(){r._isEnabled&&r._mouseOut()}),r},mouseDown:function(e){var t=this;return t._mouseDown=e,t._rect.mousedown(function(){t._isEnabled&&t._mouseDown()}),t},mouseUp:function(e){var t=this;return t._mouseUp=e,t._rect.mouseup(function(){t._isEnabled&&t._mouseUp()}),t},addIcon:function(e){var t=this;return t._icons.push(e),t._paths.push(e._path),t.showIcon(t._icons.length-1),t._rect.toFront(),t},insertIcon:function(e,t){var r=this;return r._icons.splice(e,1,t),r},removeIcon:function(e){var t=this;return t._icons[e]._path.remove(),t._icons.splice(e,1),t},showIcon:function(e){var t=this;for(ndx in t._icons)t._icons[ndx].hide();return t._icons[e].show(),t},highlight:function(e,t){var r=this;return e?(r.activeIcon().glow(t),r.activeIcon()._path.attr({fill:"90-#6B9DF4-#4575ED",stroke:"none"})):(r.activeIcon().glow(!1),r.activeIcon()._path.attr({fill:"90-#888-#CCC",stroke:"none"})),r},enable:function(){var e=this;return e._isEnabled=!0,e},disable:function(){var e=this;return e._isEnabled=!1,e},select:function(){var e=this;return e._isSelected=!0,e.highlight(!0,!0),e},deselect:function(){var e=this;return e._isSelected=!1,e.highlight(!1,!1),e}},P={init:function(t,r){var n=this;n._board=t,n._isEnabled=!0,n._height=40,n._container=e("#"+r),n._buttons=[],n._container.css({position:"relative",width:n._board.width()+"px",height:n._height+"px"}),n._paper=Raphael(r,n._board.width(),n._height);var i=n._container.children(":first");"relative"==i.css("position")&&(i.css("left",""),i.css("top","")),n._background=n._paper.rect(0,0,n._board.width(),n._height).attr({fill:"90-#555-#000",stroke:"none"});var s={move:{title:"Move",path:"M14.296,27.885v-2.013c0,0-0.402-1.408-1.073-2.013c-0.671-0.604-1.274-1.274-1.409-1.61c0,0-0.268,0.135-0.737-0.335s-1.812-2.616-1.812-2.616l-0.671-0.872c0,0-0.47-0.671-1.275-1.342c-0.805-0.672-0.938-0.067-1.476-0.738s0.604-1.275,1.006-1.409c0.403-0.134,1.946,0.134,2.684,0.872c0.738,0.738,0.738,0.738,0.738,0.738l1.073,1.141l0.537,0.201l0.671-1.073l-0.269-2.281c0,0-0.604-2.55-0.737-4.764c-0.135-2.214-0.47-5.703,1.006-5.837s1.007,2.55,1.073,3.489c0.067,0.938,0.806,5.232,1.208,5.568c0.402,0.335,0.671,0.066,0.671,0.066l0.402-7.514c0,0-0.479-2.438,1.073-2.549c0.939-0.067,0.872,1.543,0.872,2.147c0,0.604,0.269,7.514,0.269,7.514l0.537,0.135c0,0,0.402-2.214,0.604-3.153s0.604-2.416,0.537-3.087c-0.067-0.671-0.135-2.348,1.006-2.348s0.872,1.812,0.939,2.415s-0.134,3.153-0.134,3.757c0,0.604-0.738,3.623-0.537,3.824s2.08-2.817,2.349-3.958c0.268-1.141,0.201-3.02,1.408-2.885c1.208,0.134,0.47,2.817,0.402,3.086c-0.066,0.269-0.671,2.349-0.872,2.952s-0.805,1.476-1.006,2.013s0.402,2.349,0,4.629c-0.402,2.281-1.61,5.166-1.61,5.166l0.604,2.08c0,0-1.744,0.671-3.824,0.805C16.443,28.221,14.296,27.885,14.296,27.885z",scale:"0.8"},pen:{title:"Pen",path:"M25.31,2.872l-3.384-2.127c-0.854-0.536-1.979-0.278-2.517,0.576l-1.334,2.123l6.474,4.066l1.335-2.122C26.42,4.533,26.164,3.407,25.31,2.872zM6.555,21.786l6.474,4.066L23.581,9.054l-6.477-4.067L6.555,21.786zM5.566,26.952l-0.143,3.819l3.379-1.787l3.14-1.658l-6.246-3.925L5.566,26.952z",scale:"0.7"},line:{title:"Line",path:"M6.63,21.796l-5.122,5.121h25.743V1.175L6.63,21.796zM18.702,10.48c0.186-0.183,0.48-0.183,0.664,0l1.16,1.159c0.184,0.183,0.186,0.48,0.002,0.663c-0.092,0.091-0.213,0.137-0.332,0.137c-0.121,0-0.24-0.046-0.33-0.137l-1.164-1.159C18.519,10.96,18.519,10.664,18.702,10.48zM17.101,12.084c0.184-0.183,0.48-0.183,0.662,0l2.156,2.154c0.184,0.183,0.184,0.48,0.002,0.661c-0.092,0.092-0.213,0.139-0.334,0.139s-0.24-0.046-0.33-0.137l-2.156-2.154C16.917,12.564,16.917,12.267,17.101,12.084zM15.497,13.685c0.184-0.183,0.48-0.183,0.664,0l1.16,1.161c0.184,0.183,0.182,0.48-0.002,0.663c-0.092,0.092-0.211,0.138-0.33,0.138c-0.121,0-0.24-0.046-0.332-0.138l-1.16-1.16C15.314,14.166,15.314,13.868,15.497,13.685zM13.896,15.288c0.184-0.183,0.48-0.181,0.664,0.002l1.158,1.159c0.183,0.184,0.183,0.48,0,0.663c-0.092,0.092-0.212,0.138-0.332,0.138c-0.119,0-0.24-0.046-0.332-0.138l-1.158-1.161C13.713,15.767,13.713,15.471,13.896,15.288zM12.293,16.892c0.183-0.184,0.479-0.184,0.663,0l2.154,2.153c0.184,0.184,0.184,0.481,0,0.665c-0.092,0.092-0.211,0.138-0.33,0.138c-0.121,0-0.242-0.046-0.334-0.138l-2.153-2.155C12.11,17.371,12.11,17.075,12.293,16.892zM10.302,24.515c-0.091,0.093-0.212,0.139-0.332,0.139c-0.119,0-0.238-0.045-0.33-0.137l-2.154-2.153c-0.184-0.183-0.184-0.479,0-0.663s0.479-0.184,0.662,0l2.154,2.153C10.485,24.036,10.485,24.332,10.302,24.515zM10.912,21.918c-0.093,0.093-0.214,0.139-0.333,0.139c-0.12,0-0.24-0.045-0.33-0.137l-1.162-1.161c-0.184-0.183-0.184-0.479,0-0.66c0.184-0.185,0.48-0.187,0.664-0.003l1.161,1.162C11.095,21.438,11.095,21.735,10.912,21.918zM12.513,20.316c-0.092,0.092-0.211,0.138-0.332,0.138c-0.119,0-0.239-0.046-0.331-0.138l-1.159-1.16c-0.184-0.184-0.184-0.48,0-0.664s0.48-0.182,0.663,0.002l1.159,1.161C12.696,19.838,12.696,20.135,12.513,20.316zM22.25,21.917h-8.67l8.67-8.67V21.917zM22.13,10.7c-0.09,0.092-0.211,0.138-0.33,0.138c-0.121,0-0.242-0.046-0.334-0.138l-1.16-1.159c-0.184-0.183-0.184-0.479,0-0.663c0.182-0.183,0.479-0.183,0.662,0l1.16,1.159C22.312,10.221,22.313,10.517,22.13,10.7zM24.726,10.092c-0.092,0.092-0.213,0.137-0.332,0.137s-0.24-0.045-0.33-0.137l-2.154-2.154c-0.184-0.183-0.184-0.481,0-0.664s0.482-0.181,0.664,0.002l2.154,2.154C24.911,9.613,24.909,9.91,24.726,10.092z",scale:"0.7"},arrow:{title:"Arrow",path:"M21.786,12.876l7.556-4.363l-7.556-4.363v2.598H2.813v3.5h18.973V12.876zM10.368,18.124l-7.556,4.362l7.556,4.362V24.25h18.974v-3.501H10.368V18.124z",scale:"0.7"},circle:{title:"Circle",path:"M16,1.466C7.973,1.466,1.466,7.973,1.466,16 c0,8.027,6.507,14.534,14.534,14.534 c8.027,0,14.534-6.507,14.534-14.534 C30.534,7.973,24.027,1.466,16,1.466z",scale:"0.7"},rect:{title:"Rectangle",path:"M5.5,5.5h20v20h-20z",scale:""},text:{title:"Text",path:"M22.255,19.327l-1.017,0.131c-0.609,0.081-1.067,0.208-1.375,0.382c-0.521,0.293-0.779,0.76-0.779,1.398c0,0.484,0.178,0.867,0.532,1.146c0.354,0.28,0.774,0.421,1.262,0.421c0.593,0,1.164-0.138,1.72-0.412c0.938-0.453,1.4-1.188,1.4-2.229v-1.354c-0.205,0.131-0.469,0.229-0.792,0.328C22.883,19.229,22.564,19.29,22.255,19.327zM8.036,18.273h4.309l-2.113-6.063L8.036,18.273zM28.167,7.75H3.168c-0.552,0-1,0.448-1,1v16.583c0,0.553,0.448,1,1,1h24.999c0.554,0,1-0.447,1-1V8.75C29.167,8.198,28.721,7.75,28.167,7.75zM14.305,23.896l-1.433-4.109H7.488L6,23.896H4.094L9.262,10.17h2.099l4.981,13.727H14.305L14.305,23.896zM26.792,23.943c-0.263,0.074-0.461,0.121-0.599,0.141c-0.137,0.02-0.323,0.027-0.562,0.027c-0.579,0-0.999-0.204-1.261-0.615c-0.138-0.219-0.231-0.525-0.29-0.926c-0.344,0.449-0.834,0.839-1.477,1.169c-0.646,0.329-1.354,0.493-2.121,0.493c-0.928,0-1.688-0.28-2.273-0.844c-0.589-0.562-0.884-1.271-0.884-2.113c0-0.928,0.29-1.646,0.868-2.155c0.578-0.511,1.34-0.824,2.279-0.942l2.682-0.336c0.388-0.05,0.646-0.211,0.775-0.484c0.063-0.146,0.104-0.354,0.104-0.646c0-0.575-0.203-0.993-0.604-1.252c-0.408-0.26-0.99-0.389-1.748-0.389c-0.877,0-1.5,0.238-1.865,0.713c-0.205,0.263-0.34,0.654-0.399,1.174H17.85c0.031-1.237,0.438-2.097,1.199-2.582c0.77-0.484,1.659-0.726,2.674-0.726c1.176,0,2.131,0.225,2.864,0.673c0.729,0.448,1.093,1.146,1.093,2.093v5.766c0,0.176,0.035,0.313,0.106,0.422c0.071,0.104,0.223,0.156,0.452,0.156c0.076,0,0.16-0.005,0.254-0.015c0.093-0.011,0.191-0.021,0.299-0.041L26.792,23.943L26.792,23.943z",scale:""},cut:{title:"Cut",path:"M11.108,10.271c1.083-1.876,0.159-4.443-2.059-5.725C8.231,4.074,7.326,3.825,6.433,3.825c-1.461,0-2.721,0.673-3.373,1.801C2.515,6.57,2.452,7.703,2.884,8.814C3.287,9.85,4.081,10.751,5.12,11.35c0.817,0.473,1.722,0.723,2.616,0.723c0.673,0,1.301-0.149,1.849-0.414c0.669,0.387,1.566,0.904,2.4,1.386c1.583,0.914,0.561,3.861,5.919,6.955c5.357,3.094,11.496,1.535,11.496,1.535L10.75,10.767C10.882,10.611,11.005,10.449,11.108,10.271zM9.375,9.271c-0.506,0.878-2.033,1.055-3.255,0.347C5.474,9.245,4.986,8.702,4.749,8.09C4.541,7.555,4.556,7.035,4.792,6.626c0.293-0.509,0.892-0.801,1.64-0.801c0.543,0,1.102,0.157,1.616,0.454C9.291,6.996,9.898,8.366,9.375,9.271zM17.246,15.792c0,0.483-0.392,0.875-0.875,0.875c-0.037,0-0.068-0.017-0.104-0.021l0.667-1.511C17.121,15.296,17.246,15.526,17.246,15.792zM16.371,14.917c0.037,0,0.068,0.017,0.104,0.021l-0.666,1.51c-0.188-0.16-0.312-0.39-0.312-0.656C15.496,15.309,15.887,14.917,16.371,14.917zM29.4,10.467c0,0-6.139-1.559-11.496,1.535c-0.537,0.311-0.995,0.618-1.415,0.924l4.326,2.497L29.4,10.467zM13.171,17.097c-0.352,0.851-0.575,1.508-1.187,1.859c-0.833,0.481-1.73,0.999-2.399,1.386c-0.549-0.265-1.176-0.414-1.85-0.414c-0.894,0-1.798,0.249-2.616,0.721c-2.218,1.282-3.143,3.851-2.06,5.726c0.651,1.127,1.912,1.801,3.373,1.801c0.894,0,1.799-0.25,2.616-0.722c1.04-0.601,1.833-1.501,2.236-2.536c0.432-1.112,0.368-2.245-0.178-3.189c-0.103-0.178-0.226-0.34-0.356-0.494l3.982-2.3C14.044,18.295,13.546,17.676,13.171,17.097zM9.42,24.192c-0.238,0.612-0.725,1.155-1.371,1.528c-1.221,0.706-2.75,0.532-3.257-0.347C4.27,24.47,4.878,23.099,6.12,22.381c0.514-0.297,1.072-0.453,1.615-0.453c0.749,0,1.346,0.291,1.64,0.8C9.612,23.138,9.628,23.657,9.42,24.192z",scale:"0.7"},undo:{title:"Undo",path:"M12.981,9.073V6.817l-12.106,6.99l12.106,6.99v-2.422c3.285-0.002,9.052,0.28,9.052,2.269c0,2.78-6.023,4.263-6.023,4.263v2.132c0,0,13.53,0.463,13.53-9.823C29.54,9.134,17.952,8.831,12.981,9.073z",scale:"0.7"},redo:{title:"Redo",path:"M12.981,9.073V6.817l-12.106,6.99l12.106,6.99v-2.422c3.285-0.002,9.052,0.28,9.052,2.269c0,2.78-6.023,4.263-6.023,4.263v2.132c0,0,13.53,0.463,13.53-9.823C29.54,9.134,17.952,8.831,12.981,9.073z",scale:"0.7...s-1,1"},clear:{title:"Clear",path:"M20.826,5.75l0.396,1.188c1.54,0.575,2.589,1.44,2.589,2.626c0,2.405-4.308,3.498-8.312,3.498c-4.003,0-8.311-1.093-8.311-3.498c0-1.272,1.21-2.174,2.938-2.746l0.388-1.165c-2.443,0.648-4.327,1.876-4.327,3.91v2.264c0,1.224,0.685,2.155,1.759,2.845l0.396,9.265c0,1.381,3.274,2.5,7.312,2.5c4.038,0,7.313-1.119,7.313-2.5l0.405-9.493c0.885-0.664,1.438-1.521,1.438-2.617V9.562C24.812,7.625,23.101,6.42,20.826,5.75zM11.093,24.127c-0.476-0.286-1.022-0.846-1.166-1.237c-1.007-2.76-0.73-4.921-0.529-7.509c0.747,0.28,1.58,0.491,2.45,0.642c-0.216,2.658-0.43,4.923,0.003,7.828C11.916,24.278,11.567,24.411,11.093,24.127zM17.219,24.329c-0.019,0.445-0.691,0.856-1.517,0.856c-0.828,0-1.498-0.413-1.517-0.858c-0.126-2.996-0.032-5.322,0.068-8.039c0.418,0.022,0.835,0.037,1.246,0.037c0.543,0,1.097-0.02,1.651-0.059C17.251,18.994,17.346,21.325,17.219,24.329zM21.476,22.892c-0.143,0.392-0.69,0.95-1.165,1.235c-0.474,0.284-0.817,0.151-0.754-0.276c0.437-2.93,0.214-5.209-0.005-7.897c0.881-0.174,1.708-0.417,2.44-0.731C22.194,17.883,22.503,20.076,21.476,22.892zM11.338,9.512c0.525,0.173,1.092-0.109,1.268-0.633h-0.002l0.771-2.316h4.56l0.771,2.316c0.14,0.419,0.53,0.685,0.949,0.685c0.104,0,0.211-0.017,0.316-0.052c0.524-0.175,0.808-0.742,0.633-1.265l-1.002-3.001c-0.136-0.407-0.518-0.683-0.945-0.683h-6.002c-0.428,0-0.812,0.275-0.948,0.683l-1,2.999C10.532,8.77,10.815,9.337,11.338,9.512z",scale:"0.8"},palette:{title:"Attributes",path:"M15.653,7.25c-3.417,0-8.577,0.983-8.577,3.282c0,1.91,2.704,3.229,1.691,3.889c-1.02,0.666-2.684-1.848-4.048-1.848c-1.653,0-2.815,1.434-2.815,2.926c0,4.558,6.326,8.25,13.749,8.25c7.424,0,13.443-3.692,13.443-8.25C29.096,10.944,23.077,7.25,15.653,7.25zM10.308,13.521c0-0.645,0.887-1.166,1.98-1.166c1.093,0,1.979,0.521,1.979,1.166c0,0.644-0.886,1.166-1.979,1.166C11.195,14.687,10.308,14.164,10.308,13.521zM14.289,22.299c-1.058,0-1.914-0.68-1.914-1.518s0.856-1.518,1.914-1.518c1.057,0,1.914,0.68,1.914,1.518S15.346,22.299,14.289,22.299zM19.611,21.771c-1.057,0-1.913-0.681-1.913-1.519c0-0.84,0.856-1.521,1.913-1.521c1.059,0,1.914,0.681,1.914,1.521C21.525,21.092,20.67,21.771,19.611,21.771zM20.075,10.66c0-0.838,0.856-1.518,1.914-1.518s1.913,0.68,1.913,1.518c0,0.839-0.855,1.518-1.913,1.518C20.934,12.178,20.075,11.499,20.075,10.66zM24.275,19.482c-1.057,0-1.914-0.681-1.914-1.519s0.857-1.518,1.914-1.518c1.059,0,1.914,0.68,1.914,1.518S25.334,19.482,24.275,19.482zM25.286,15.475c-1.058,0-1.914-0.68-1.914-1.519c0-0.838,0.856-1.518,1.914-1.518c1.057,0,1.913,0.68,1.913,1.518C27.199,14.795,26.343,15.475,25.286,15.475z",scale:""}},c=4;for(var l in s){var u=o(n,l,{x:c-4,y:0,width:n._height,height:n._height,title:s[l].title,fill:"rgba(0,0,0,0)",stroke:"none"});u.addIcon(a(u,s[l].path,{fill:"90-#888-#CCC",stroke:"none",transform:"t"+c+",4"+(""!=s[l].scale?"s"+s[l].scale:"")})),u.hover(function(){n._board.options.editable&&!this.isSelected()&&"undo"!=this.name()&&"redo"!=this.name()&&this.highlight(!0,!1)},function(){n._board.options.editable&&!this.isSelected()&&"undo"!=this.name()&&"redo"!=this.name()&&this.highlight(!1,!1)}),u.mouseDown(function(){if(n._board.options.editable&&!this.isSelected())switch(this.name()){case"undo":case"redo":break;case"clear":this.select();break;case"palette":n._board.canvas._container.unbind("mouseenter"),this.select();break;default:n.deselectAll(),n._board.mode()!=this.name()&&n._board.mode(this.name())}}),u.mouseUp(function(){if(n._board.options.editable)switch(this.name()){case"undo":n._board.undo();break;case"redo":n._board.redo();break;case"clear":this.deselect(),this.highlight(!0,!1),n._board.clear();break;case"palette":n._board.attributesPanel.show(),this.deselect(),this.highlight(!0,!0);break;default:}}),n.addButton(u),c+=n._height}return n},height:function(){return this._height},background:function(){return this._background},buttons:function(){return this._buttons},enable:function(){var e=this;e._isEnabled=!0,s(!0);var t=e.button(e._board.mode());return"undo"!=t.name()&&"redo"!=t.name()&&t.select(),e},disable:function(){var e=this;return e._isEnabled=!1,s(!1),e.deselectAll(),e},addButton:function(e){var t=this;return t._buttons.push(e),t},insertButton:function(e,t){var r=this;return r._buttons.splice(t,1,e),r},removeButton:function(t){var r=this;return r._buttons.splice(e.inArray(t,r._buttons),1),t.set.clear(),r},button:function(e){var t=this;for(idx in t._buttons)if(t._buttons[idx].name()==e)return t._buttons[idx]},deselectAll:function(){var e=this,t=e._buttons;for(idx in t)"undo"!=t[idx].name()&&"redo"!=t[idx].name()&&t[idx].deselect();return e},toggleUndoRedo:function(){var e=this,t=e.button("undo"),r=e.button("redo");return e._board.canUndo()?(t.activeIcon()._path.attr({fill:"90-#BBF1B2-#5D9E54",stroke:"none"}),t.enable()):(t.activeIcon()._path.attr({fill:"90-#888-#CCC",stroke:"none"}),t.disable()),e._board.canRedo()?(r.activeIcon()._path.attr({fill:"90-#BBF1B2-#5D9E54",stroke:"none"}),r.enable()):(r.activeIcon()._path.attr({fill:"90-#888-#CCC",stroke:"none"}),r.disable()),e}},$={init:function(t,r){var n=this;n._board=t,n._container=e("#"+r),n._container.css({position:"absolute",width:n._board.width()+"px",height:n._board.height()-(n._board.options.showToolBar?n._board.toolBar.height():0)+"px"}),n._paper=Raphael(r,n._board.width(),n._board.height()-(n._board.options.showToolBar?n._board.toolBar.height():0));var a=n._container.children(":first");return"relative"==a.css("position")&&(a.css("left",""),a.css("top","")),n},paper:function(){return this._paper}},G={init:function(t,r){var n=this;n._board=t,n._container=e("#"+r),n._container.css({position:"absolute","z-index":"9999",display:"none"}),n._paper=Raphael(r,n._board.width(),n._board.height());var a=n._container.children(":first");return"relative"==a.css("position")&&(a.css("left",""),a.css("top","")),n},paper:function(){return this._paper},show:function(){var t=this,r=["#000","#FFF","#F00","#0F0","#00F","#FF0"],n=t._board.width(),a=t._board.height();t._container.css({top:"0px",width:n+"px",height:a+"px"}),t._panel=t._paper.set(),t._panel.push(t._paper.rect(0,0,n,a).attr({fill:"rgba(0,0,0,0.25)",stroke:"none",cursor:"auto"})),t._panel.push(t._paper.rect(n/2-110,a/2-110,220,220,16).attr({fill:"rgba(0,0,0,0.5)",stroke:"none"}));var o=t._paper.circle(n/2,a/2,90).attr({fill:t._board.options.fill,stroke:t._board.options.stroke,"stroke-width":t._board.options.strokeWidth,cursor:"pointer"});t._panel.push(o);for(var i=t._paper.set(),s=0,c=0;360>c;){var l=r[s];(function(e,r){i.push(t._paper.circle(n/2,a/2+40,16).attr({stroke:r,fill:r,transform:e,cursor:"pointer"}).click(function(){o.attr({fill:this.attr("fill")})}))})("r"+c+" "+n/2+" "+a/2,l),s++,c+=60}var u=t._paper.set(),d=t._paper.circle(n/2,a/2,16).attr({fill:"rgba(0,0,0,0)",stroke:"none"});u.push(d),u.push(t._paper.path("M11.478,17.568c-0.172-0.494-0.285-1.017-0.285-1.568c0-2.65,2.158-4.807,4.807-4.807c0.552,0,1.074,0.113,1.568,0.285l2.283-2.283C18.541,8.647,17.227,8.286,16,8.286C8.454,8.286,2.5,16,2.5,16s2.167,2.791,5.53,5.017L11.478,17.568zM23.518,11.185l-3.056,3.056c0.217,0.546,0.345,1.138,0.345,1.76c0,2.648-2.158,4.807-4.807,4.807c-0.622,0-1.213-0.128-1.76-0.345l-2.469,2.47c1.327,0.479,2.745,0.783,4.229,0.783c5.771,0,13.5-7.715,13.5-7.715S26.859,13.374,23.518,11.185zM25.542,4.917L4.855,25.604L6.27,27.02L26.956,6.332L25.542,4.917z").attr({fill:"#FFF",stroke:"#000",transform:"t"+(n/2-16)+","+(a/2-16)})),u.attr({cursor:"pointer"}).hover(function(){d.attr({fill:"rgba(255,255,255,0.5)"})},function(){d.attr({fill:"rgba(0,0,0,0)"})}).click(function(){o.attr({fill:"none"}),0==o.attr("stroke-width")&&o.attr({"stroke-width":1})}),i.push(u);for(var s=0,c=105;270>c;){var l=r[s];(function(e,r){t._panel.push(t._paper.circle(n/2,a/2+90,16).attr({stroke:r,fill:r,transform:e,cursor:"pointer"}).click(function(){o.attr({stroke:this.attr("fill")})}))})("r"+c+" "+n/2+" "+a/2,l),s++,c+=30}for(var c=300,h=12;420>=c;){var l="#000";(function(e,r,i){var s=t._paper.set(),c=t._paper.circle(n/2,a/2+90,16).attr({stroke:"none",fill:"#C0C0C0"});if(s.push(c),i>0&&s.push(t._paper.circle(n/2,a/2+90,i/2).attr({stroke:"none",fill:r})),s.attr({stroke:"rgba(0,0,0,0)","stroke-width":0==i?0:i/2,transform:e,cursor:"pointer"}),0==i){var l=c.getBBox(!1);s.push(t._paper.path("M11.478,17.568c-0.172-0.494-0.285-1.017-0.285-1.568c0-2.65,2.158-4.807,4.807-4.807c0.552,0,1.074,0.113,1.568,0.285l2.283-2.283C18.541,8.647,17.227,8.286,16,8.286C8.454,8.286,2.5,16,2.5,16s2.167,2.791,5.53,5.017L11.478,17.568zM23.518,11.185l-3.056,3.056c0.217,0.546,0.345,1.138,0.345,1.76c0,2.648-2.158,4.807-4.807,4.807c-0.622,0-1.213-0.128-1.76-0.345l-2.469,2.47c1.327,0.479,2.745,0.783,4.229,0.783c5.771,0,13.5-7.715,13.5-7.715S26.859,13.374,23.518,11.185zM25.542,4.917L4.855,25.604L6.27,27.02L26.956,6.332L25.542,4.917z").attr({fill:"#000",stroke:"rgba(0,0,0,0)","stroke-width":0==i?0:i/2,transform:"t"+l.x+","+l.y}))}s.click(function(){i=this.attr("stroke-width"),0==i?"none"==o.attr("fill")&&o.attr({fill:t._board.options.fill}):i=1==i?1:2*i,o.attr({"stroke-width":i})}),t._panel.push(s)})("r"+c+" "+n/2+" "+a/2,l,h),c+=30,h-=4,0>h?h=0:0==h&&(h=2)}var f=t._paper.circle(n/2-90,a/2+90,16).attr({fill:"rgba(0,0,0,0)",stroke:"none"}),u=t._paper.set();u.push(f),u.push(t._paper.path("M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z").attr({fill:"#F00",stroke:"none",transform:"t"+(n/2-90-16)+","+(a/2+90-16)})),u.attr({cursor:"pointer"}).hover(function(){f.attr({fill:"rgba(255,0,0,0.25)"})},function(){f.attr({fill:"rgba(0,0,0,0)"})}).click(function(){t.hide(),t._board.canvas._container.mousemove(M(t._board.canvas._container)),t._board.canvas._container.unbind("mousemove")
}),t._panel.push(u);var p=t._paper.circle(n/2+90,a/2+90,16).attr({fill:"rgba(0,0,0,0)",stroke:"none"}),u=t._paper.set();return u.push(p),u.push(t._paper.path("M2.379,14.729 5.208,11.899 12.958,19.648 25.877,6.733 28.707,9.561 12.958,25.308z").attr({fill:"#0F0",stroke:"none",transform:"t"+(n/2+90-16)+","+(a/2+90-16)})),u.attr({cursor:"pointer"}).hover(function(){p.attr({fill:"rgba(0,255,0,0.25)"})},function(){p.attr({fill:"rgba(0,0,0,0)"})}).click(function(){t._board.options.stroke=o.attr("stroke"),t._board.options.fill=o.attr("fill"),t._board.options.strokeWidth=o.attr("stroke-width"),t.hide(),t._board.canvas._container.mousemove(M(t._board.canvas._container)),t._board.canvas._container.unbind("mousemove")}),t._panel.push(u),t._panel.attr({cursor:"pointer"}),e(t._container).show(),t},hide:function(){var t=this;return e(t._container).hide(),t._paper.clear(),t}},Q={init:function(t,r){var a=this;if(a._version="1.1.0",a._UUID=Raphael.createUUID(),a.elem=r,a.$elem=e(r),t&&t.strokeWidth)switch(t.strokeWidth){case"medium":t.strokeWidth=4;break;case"big":t.strokeWidth=8;break;case"huge":t.strokeWidth=12;break;default:t.strokeWidth=1}if(a.options=e.extend({},e.fn.RaphBoard.options,t),a.eventHandlers={before_mode_change:null,after_mode_change:null,before_start:null,after_start:null,before_change:null,after_change:null,before_end:null,after_end:null,before_select:null,after_select:null,before_deselect:null,after_deselect:null,before_show_handles:null,after_show_handles:null,before_hide_handles:null,after_hide_handles:null,before_move:null,after_move:null,before_cut:null,after_cut:null,before_undo:null,after_undo:null,before_redo:null,after_redo:null,before_clear:null,after_clear:null,updateUndoRedo:null},P!==n&&null!=P){var o="r_b-toolbar";a.$elem.append("<div id='"+o+"'/>"),a.toolBar=i(a,o);var s="r_b-overlay";a.$elem.append("<div id='"+s+"'/>"),a.attributesPanel=l(a,s)}var u="r_b-paper";return a.$elem.append("<div id='"+u+"'/>"),a.canvas=c(a,u),a.paper=a.canvas.paper(),a.elements=[],a.undoBuffer=[],a.redoBuffer=[],a.mode("pen"),a.mouseDownX=a.mouseDownY=a.mouseUpX=a.mouseUpY=0,a.canvas._container.mouseenter(S),a},container:function(){return this.elem},version:function(){return this._version},UUID:function(){return this._UUID},left:function(){return this.$elem.offset().left},top:function(){return this.$elem.offset().top},width:function(){return this.$elem.width()},height:function(){return this.$elem.height()},isEnabled:function(){return this.options.editable},canUndo:function(){return this.undoBuffer.length>0},canRedo:function(){return this.redoBuffer.length>0},getAttribute:function(e){var t=this.options;return"align"==e?t.textAnchor:t[e]},toggleAttribute:function(e){var t=this.options;switch(e){case"editable":t.editable=!t.editable;break;case"bold":t.fontWeight="bold"==t.fontWeight?"normal":"bold";break;case"italic":t.fontStyle="italic"==t.fontStyle?"normal":"italic";break;case"underline":t.textDecoration="underline"==t.textDecoration?"none":"underline";break;case"strike":t.textDecoration="line-through"==t.textDecoration?"none":"line-through";break;default:}return t[e]},setAttribute:function(e,t){var r=this.options;if("align"==e)switch(t){case"left":r.textAnchor="start";break;case"center":r.textAnchor="middle";break;case"right":r.textAnchor="end";break;case"justify":r.textAnchor="middle";break;default:r.textAnchor="start"}else r[e]=t;return r[e]},on:function(t,r){var a=this;return e.each(a.eventHandlers,function(e){return(e=t)?(a.eventHandlers[t]=r,!1):n}),a},off:function(t){var r=this;return e.each(r.eventHandlers,function(e){return(e=t)?(r.eventHandlers[t]=null,!1):n}),r},enable:function(){var e=this;return e.options.editable=!0,e.toolBar&&e.toolBar.enable(),e},disable:function(){var e=this;return e.canvas._container.unbind("mouseenter"),e.elem.removeClasses("cursor-*"),e.options.editable=!1,e.toolBar&&e.toolBar.disable(),e},mode:function(e){var t=this;return e!==n&&(z(t,"before_mode_change")&&(h(t),t._mode=e,t.options.editable&&t.toolBar&&(t.toolBar.deselectAll(),t.toolBar.button(t._mode).select()),u(t)),z(t,"after_mode_change")),t._mode},element:function(t){var r,a=this;return e.each(a.elements,function(e,a){return a.id==t?(r=a,!1):n}),r},initMove:function(e,t){var r=this,n=r.element(e);if(n&&n.freeTransform)var a=n.freeTransform;else var a=p(r,n);return t?a.hideHandles({undrag:!1}):a.showHandles(),n},select:function(e){var t=this;return t.initMove(e)},deselect:function(e,t){var r=this,n=r.element(e);return n&&f(n,t),n},showHandles:function(e){var t=this,r=t.element(e);return r?v(t,r):n},hideHandles:function(e){var t=this,r=t.element(e);return r?g(t,r):n},move:function(e,t,r){var n=this,a=n.element(e);if(n.options.animation,a){switch(a.type){case"path":var o=a.matrix.toTransformString().replace("t","").split(",");a.ox=o[0]?o[0]:0,a.oy=o[1]?o[1]:0;break;case"circle":case"ellipse":a.ox=a.attr("cx"),a.oy=a.attr("cy");break;default:a.ox=a.attr("x"),a.oy=a.attr("y")}var i=t-a.ox,s=r-a.oy;switch(a.type){case"path":a.transform("t"+(parseInt(a.ox)+parseInt(i))+","+(parseInt(a.oy)+parseInt(s)));break;case"circle":case"ellipse":a.attr({cx:a.ox+i,cy:a.oy+s});break;default:a.attr({x:a.ox+i,y:a.oy+s})}n.paper.safari(),I(n,"move",a)}return a},modify:function(e,t){var r=this,n=r.element(e);return r.options.animation,n&&"object"==typeof t&&(n.attr(t),r.paper.safari(),I(r,"modify",n)),n},transform:function(e,t){var r=this;r.options.animation;var n=r.element(e);return n&&"string"==typeof t&&(n.transform(t),r.paper.safari(),I(r,"transform",n)),n},freeTransform:function(e,t){var r=this,n=r.element(e);if(n){if("object"!=typeof t)return T(r,n);L(r,n,t),I(r,"move",n)}return n},line:function(e,t,r,n){var a=this;if(0!=r||0!=n){var o=W(a,e,t);return o.attr("path","M"+e+","+t+"L"+r+","+n),a.elements.push(o),I(a,"line",o),o}return null},arrow:function(e,t,r,n){var a=this;if(0!=r||0!=n){var o=W(a,e,t);return o.attr("path","M"+e+","+t+"L"+r+","+n),a.elements.push(o),I(a,"arrow",o),o}return null},circle:function(e,t,r){var n=this;if(0!=r){var a=j(n,e,t);return a.attr("r",r),n.elements.push(a),I(n,"circle",a),a}return null},ellipse:function(e,t,r,n){var a=this;if(0!=r||0!=n){var o=A(a,e,t);return o.attr("rx",r).attr("ry",n),a.elements.push(o),I(a,"ellipse",o),o}return null},rect:function(e,t,r,n){var a=this;if(0!=r||0!=n){var o=H(a,e,t);return o.attr("dx",r).attr("dy",n),a.elements.push(o),I(a,"rect",o),o}return null},text:function(e,t,r,n){var a=this;if(r&&""!=r){if(n&&!isNaN(n)){var o=Math.abs(parseInt(n));a.options.fontSize=0==o?12:o}var i=Y(a,e,t,r);return a.elements.push(i),I(a,"text",i),z(a,"after_end"),i}return null},cut:function(e){var t=this,r=t.elements,n=!1;if(r.length>0)for(var a=0;r.length>a;a++)if(r[a].id==e){I(t,"cut",r[a]),r[a].remove(),r.splice(a,1),n=!0;break}return n},toJSON:function(e,t){var r=this,n=[],a=[],o=r.paper,i=function(e){var a=t?t(e,{}):{};a&&(a.ft={attrs:T(r,e)},n.push({command:e.type,element:{data:a,type:e.type,attrs:e.attrs,transform:e.matrix.toTransformString(),id:e.id}}))};e?i(o.getById(e)):o.forEach(function(e){i(e)});var s=JSON.stringify(n,function(e,t){if("object"==typeof t&&null!=t){if(-1!==a.indexOf(t))return;a.push(t)}return t});return n=a=null,s},fromJSON:function(e,t){var r,n=this,a=[];r="string"==typeof e?JSON.parse(e):e,r instanceof Array?a=r:a.push(r);for(var o in a)if(a.hasOwnProperty(o)){var i=J(n,a[o].element),s=a[o].element.data;s&&s.ft&&s.ft.attrs&&L(n,i,s.ft.attrs),t&&t(i),I(n,a[o].command,i)}},undo:function(){var e=this;if(e.canUndo()&&z(e,"before_undo")){e.paper;var t=e.elements,r=e.undoBuffer,n=r.pop(),a=n.command;switch(h(e),a){case"move":var o=O(r,n.element.id);o&&(e.freeTransform(o.id,o.data.ft.attrs),e.undoBuffer.pop());break;case"modify":var o=O(r,n.element.id);if(o){e.modify(o.id,o.attrs),e.undoBuffer.pop();break}break;case"transform":var o=O(r,n.element.id);if(o){e.transform(o.id,o.transform),e.undoBuffer.pop();break}break;case"cut":J(e,n.element);break;case"clear":n.elements.map(function(t){J(e,t)});break;default:t.pop().remove()}switch(e.redoBuffer.push(n),a){case"modify":case"transform":case"undo":case"redo":case"clear":break;default:e.mode(a),u(e)}}return e.toggleUndoRedo(),z(e,"after_undo"),e},clearUndo:function(){var e=this;return e.undoBuffer=[],e.toggleUndoRedo(),e},redo:function(){var e=this;if(e.canRedo()&&z(e,"before_redo")){e.elements;var t=e.redoBuffer;e.paper;var r=t.pop(),n=r.command,a=r.element;switch(h(e),n){case"move":e.freeTransform(a.id,r.element.data.ft.attrs),e.undoBuffer.pop(),e.undoBuffer.push(r);break;case"modify":e.modify(a.id,a.attrs);break;case"transform":e.transform(a.id,a.transform);break;case"cut":e.cut(a.id);break;case"clear":e.clear();break;default:J(e,a),e.undoBuffer.push(r)}switch(n){case"modify":case"transform":case"undo":case"redo":case"clear":break;default:e.mode(n),u(e)}}return e.toggleUndoRedo(),z(e,"after_redo"),e},clearRedo:function(){var e=this;return e.redoBuffer=[],e.toggleUndoRedo(),e},toggleUndoRedo:function(){var e=this;if(e.toolBar){var t=e.eventHandlers.updateUndoRedo;t?t(e):e.toolBar.toggleUndoRedo()}return e},clear:function(){var e=this;if(e.elements.length>0&&z(e,"before_clear")){h(e);var t=[];e.elements.map(function(r){t.push(E(e,r))}),e.undoBuffer.push({command:"clear",elements:t}),e.elements=[],e.paper.clear()}return e.clearRedo(),z(e,"after_clear"),e},flush:function(){var e=this;return h(e),e.elements=[],e.paper.clear(),e.clearUndo(),e.clearRedo(),e}};e.fn.RaphBoard=function(t,r){var a=e(this).data("RaphBoard");return a||(a=Object.create(Q),a.init(t,this),e.data(this.get(0),"RaphBoard",a)),t!==n&&("object"==typeof t?a.options=e.extend({},e.fn.RaphBoard.options,t):"string"==typeof t&&(a.options=e.extend({},e.fn.RaphBoard.options,{options:r}))),a},e.fn.RaphBoard.options={editable:!0,stroke:"#FFF",strokeWidth:1,fill:"#FFF",lineCap:"round",lineJoin:"round",arrowEnd:"classic-medium-medium",fontSize:12,font:null,fontFamily:null,fontStyle:null,fontWeight:null,textAnchor:"start",textDecoration:null,animation:{delay:100,easing:"<>"}},e.fn.removeClasses=function(e){return this.removeClass(function(t,r){var n=e.replace(/\*/g,"\\S+");return(r.match(RegExp("\\b"+n,"g"))||[]).join(" ")})}}(jQuery,window,document);